{% extends "layout.html" %}

{% block title %}Track Your Carbon Footprint | Carbon Tracker{% endblock %}

{% block content %}
<!-- CDN Scripts -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
  :root {
    --primary-green: #27ae60;
    --primary-blue: #3498db;
    --dark-green: #229954;
    --light-green: #58d68d;
  }
  
  .gradient-text {
    background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .tab-button {
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    cursor: pointer;
  }
  
  .tab-button.active {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
  }
  
  .tab-button:not(.active) {
    background: white;
    color: #64748b;
    border-color: #e2e8f0;
  }
  
  .tab-button:not(.active):hover {
    border-color: var(--primary-green);
    color: var(--primary-green);
  }
  
  .form-input, .form-select {
    width: 100%;
    padding: 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
    color: #1e293b;
    font-weight: 500;
  }
  
  .form-input:focus, .form-select:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
    color: #1e293b;
  }
  
  .form-input::placeholder {
    color: #94a3b8;
    font-weight: 400;
  }
  
  .form-select option {
    color: #1e293b;
    background: white;
    padding: 0.5rem;
    font-weight: 500;
  }
  
  .form-input:disabled {
    background: #f1f5f9;
    color: #94a3b8;
    cursor: not-allowed;
  }
  
  .slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: #e2e8f0;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
  }
  
  .slider::-webkit-slider-thumb {
    appearance: none;
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary-green);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
    border: 2px solid white;
  }
  
  .slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary-green);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
    border: 2px solid white;
  }
  
  .progress-gauge {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: conic-gradient(var(--primary-green) 0deg 252deg, #e5e7eb 252deg 360deg);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin: 0 auto;
  }
  
  .progress-gauge::before {
    content: '';
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: white;
    position: absolute;
  }
  
  .drag-drop-area {
    border: 3px dashed #cbd5e1;
    border-radius: 16px;
    padding: 3rem;
    text-align: center;
    transition: all 0.3s ease;
    background: #f8fafc;
    cursor: pointer;
  }
  
  .drag-drop-area.dragover {
    border-color: var(--primary-green);
    background: rgba(39, 174, 96, 0.05);
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
  }
  
  .category-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }
  
  .category-card:hover {
    border-color: var(--primary-green);
    transform: translateY(-2px);
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  /* Enhanced visibility for form elements */
  input[type="number"], input[type="text"], select {
    color: #1e293b !important;
    background-color: white !important;
    font-size: 16px !important;
    font-weight: 500 !important;
  }
  
  input[type="number"]:focus, input[type="text"]:focus, select:focus {
    color: #1e293b !important;
    background-color: white !important;
  }
  
  select option {
    color: #1e293b !important;
    background-color: white !important;
    font-size: 16px !important;
    padding: 8px !important;
  }
  
  /* Checkbox styling */
  input[type="checkbox"] {
    accent-color: var(--primary-green);
    transform: scale(1.2);
  }
  
  /* Number input styling */
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
  }
  
  /* Energy tab styling */
  .energy-tab-btn {
    color: #64748b;
  }
  
  .energy-tab-btn.active {
    background: white;
    color: #1e293b;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  .energy-tab-content {
    display: none;
  }
  
  .energy-tab-content.active {
    display: block;
  }
</style>

<!-- Header Section -->
<section class="py-16 px-6 bg-gradient-to-br from-green-50 to-blue-50">
  <div class="max-w-5xl mx-auto text-center">
    <h1 class="text-5xl md:text-6xl font-black mb-6" data-aos="fade-up">
      <span class="gradient-text">Track Your Carbon Footprint in Detail</span>
    </h1>
    <div class="flex items-center justify-center gap-3 mb-8" data-aos="fade-up" data-aos-delay="100">
      <p class="text-xl text-slate-600 max-w-3xl leading-relaxed">
        Log your daily lifestyle choices ‚Äî our AI translates them into CO‚ÇÇ equivalents.
      </p>
      <div class="relative">
        <button class="info-icon w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors" onclick="toggleTooltip()">
          <i class="fas fa-info text-sm"></i>
        </button>
        <div id="tooltip" class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-80 bg-slate-800 text-white text-sm rounded-lg p-4 shadow-xl opacity-0 invisible transition-all duration-300">
          <div class="text-center">
            <h4 class="font-bold mb-2">What is a Carbon Footprint?</h4>
            <p>Your carbon footprint is the total amount of greenhouse gases (CO‚ÇÇ) produced by your daily activities, measured in kilograms or tons per year.</p>
          </div>
          <div class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800"></div>
        </div>
      </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="grid md:grid-cols-3 gap-6 max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="200">
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <div class="text-2xl font-bold text-green-600" id="todayTotal">0.0</div>
        <div class="text-sm text-slate-500">kg CO‚ÇÇ Today</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <div class="text-2xl font-bold text-blue-600" id="weeklyAvg">0.0</div>
        <div class="text-sm text-slate-500">Weekly Average</div>
      </div>
      <div class="bg-white rounded-xl p-4 shadow-sm">
        <div class="text-2xl font-bold text-purple-600" id="carbonBudget">15.0</div>
        <div class="text-sm text-slate-500">Daily Budget</div>
      </div>
    </div>
  </div>
</section>

<!-- Comprehensive Tracking Categories -->
<section class="py-16 px-6 bg-white">
  <div class="max-w-7xl mx-auto">
    <!-- Category Navigation -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 mb-12" data-aos="fade-up">
      <button class="tab-button active text-sm" onclick="switchTab('transportation')">
        <i class="fas fa-car mr-1"></i>
        Transport
      </button>
      <button class="tab-button text-sm" onclick="switchTab('food')">
        <i class="fas fa-utensils mr-1"></i>
        Food & Diet
      </button>
      <button class="tab-button text-sm" onclick="switchTab('energy')">
        <i class="fas fa-plug mr-1"></i>
        Energy
      </button>
      <button class="tab-button text-sm" onclick="switchTab('shopping')">
        <i class="fas fa-shopping-cart mr-1"></i>
        Shopping
      </button>
      <button class="tab-button text-sm" onclick="switchTab('waste')">
        <i class="fas fa-recycle mr-1"></i>
        Waste
      </button>
      <button class="tab-button text-sm" onclick="switchTab('other')">
        <i class="fas fa-globe mr-1"></i>
        Other
      </button>
      <button class="tab-button text-sm" onclick="switchTab('upload')">
        <i class="fas fa-upload mr-1"></i>
        Upload
      </button>
    </div>

    <!-- Transportation Tab -->
    <div id="transportation" class="tab-content active">
      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Input Section -->
        <div class="space-y-8" data-aos="fade-right">
          <div class="bg-white rounded-3xl p-8 shadow-lg border border-blue-100">
            <!-- Section Header -->
            <div class="mb-8">
              <h3 class="text-3xl font-bold text-slate-800 mb-3">
                <i class="fas fa-car text-blue-500 mr-3"></i>
                Transportation
              </h3>
              <p class="text-lg text-slate-600">Log your daily and monthly travel to measure emissions.</p>
            </div>
            
            <!-- Daily Commute Distance -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-route text-green-500 mr-2"></i>
                Daily Commute Distance
              </h4>
              <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-xl p-6">
                <div class="mb-4">
                  <label class="block text-sm font-medium text-slate-600 mb-3">Distance (0-200 km)</label>
                  <input type="range" min="0" max="200" value="25" class="slider w-full mb-3" id="dailyCommuteSlider" 
                         oninput="updateDailyCommute(this.value)" onchange="updateTransportCalculation()">
                  <div class="flex justify-between items-center">
                    <span class="text-sm text-slate-500">0 km</span>
                    <div class="bg-white rounded-lg px-4 py-2 shadow-sm">
                      <span class="text-2xl font-bold text-blue-600" id="dailyCommuteValue">25</span>
                      <span class="text-sm text-slate-500 ml-1">km/day</span>
                    </div>
                    <span class="text-sm text-slate-500">200 km</span>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input</label>
                  <input type="number" min="0" max="200" value="25" class="form-input w-32" id="dailyCommuteInput" 
                         oninput="updateDailyCommuteFromInput(this.value)" onchange="updateTransportCalculation()">
                </div>
              </div>
            </div>

            <!-- Car Usage -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-car text-red-500 mr-2"></i>
                Car Usage üöó
              </h4>
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-slate-600 mb-2">Car Type</label>
                  <select class="form-select" id="carType" onchange="updateTransportCalculation()">
                    <option value="petrol">Petrol</option>
                    <option value="diesel">Diesel</option>
                    <option value="electric">Electric</option>
                    <option value="hybrid">Hybrid</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-600 mb-2">Km per day</label>
                  <input type="number" min="0" placeholder="0" class="form-input" id="carKmDay" 
                         oninput="updateTransportCalculation()">
                </div>
              </div>
            </div>

            <!-- Public Transport -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-bus text-green-500 mr-2"></i>
                Public Transport üöåüöáüöÜ
              </h4>
              <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <input type="checkbox" id="metroToggle" class="mr-3 w-5 h-5 text-blue-600" onchange="togglePublicTransport('metro')">
                    <label for="metroToggle" class="font-medium text-slate-700">Metro üöá</label>
                  </div>
                  <input type="number" min="0" placeholder="km/day" class="form-input w-32" id="metroKm" 
                         disabled oninput="updateTransportCalculation()">
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <input type="checkbox" id="busToggle" class="mr-3 w-5 h-5 text-blue-600" onchange="togglePublicTransport('bus')">
                    <label for="busToggle" class="font-medium text-slate-700">Bus üöå</label>
                  </div>
                  <input type="number" min="0" placeholder="km/day" class="form-input w-32" id="busKm" 
                         disabled oninput="updateTransportCalculation()">
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                  <div class="flex items-center">
                    <input type="checkbox" id="trainToggle" class="mr-3 w-5 h-5 text-blue-600" onchange="togglePublicTransport('train')">
                    <label for="trainToggle" class="font-medium text-slate-700">Train üöÜ</label>
                  </div>
                  <input type="number" min="0" placeholder="km/day" class="form-input w-32" id="trainKm" 
                         disabled oninput="updateTransportCalculation()">
                </div>
              </div>
            </div>

            <!-- Flights -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-plane text-blue-500 mr-2"></i>
                Flights ‚úàÔ∏è
              </h4>
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-slate-600 mb-2">Flight Type</label>
                  <select class="form-select" id="flightType" onchange="updateTransportCalculation()">
                    <option value="short">Short-Haul (&lt;3 hrs)</option>
                    <option value="long">Long-Haul (&gt;3 hrs)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-slate-600 mb-2">Trips per year</label>
                  <input type="number" min="0" placeholder="0" class="form-input" id="flightTrips" 
                         oninput="updateTransportCalculation()">
                </div>
              </div>
            </div>

            <!-- Ride-Sharing / Taxis -->
            <div class="mb-8">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-taxi text-yellow-500 mr-2"></i>
                Ride-Sharing / Taxis üöï
              </h4>
              <div class="bg-yellow-50 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                  <label class="font-medium text-slate-700">Use ride-sharing services?</label>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" id="rideShareToggle" onchange="toggleRideShare()">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                  </label>
                </div>
                <div id="rideShareInput" class="hidden">
                  <label class="block text-sm font-medium text-slate-600 mb-2">Km per day</label>
                  <input type="number" min="0" placeholder="0" class="form-input w-32" id="rideShareKm" 
                         oninput="updateTransportCalculation()">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Real-Time Feedback -->
        <div class="sticky top-8" data-aos="fade-left">
          <div class="bg-gradient-to-br from-blue-50 to-green-50 rounded-3xl p-8 shadow-xl border border-blue-200">
            <!-- Results Card Header -->
            <div class="text-center mb-8">
              <h3 class="text-2xl font-bold text-slate-800 mb-2">Transportation Footprint</h3>
              <p class="text-lg text-blue-600 font-semibold" id="transportResultText">
                Your transportation footprint today: <span id="transportTodayEmissions">4.2</span> kg CO‚ÇÇ
              </p>
            </div>
            
            <!-- Circular Progress Gauge -->
            <div class="mb-8 flex justify-center">
              <div class="relative w-48 h-48">
                <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 100 100">
                  <!-- Background circle -->
                  <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                  <!-- Progress circle -->
                  <circle cx="50" cy="50" r="40" stroke="url(#gradient)" stroke-width="8" fill="none"
                          stroke-dasharray="251.2" stroke-dashoffset="188.4" 
                          id="progressCircle" class="transition-all duration-500 ease-out"/>
                  <!-- Gradient definition -->
                  <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#3b82f6"/>
                      <stop offset="100%" style="stop-color:#10b981"/>
                    </linearGradient>
                  </defs>
                </svg>
                <!-- Center content -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center">
                    <div class="text-3xl font-black text-blue-600" id="transportGaugeValue">4.2</div>
                    <div class="text-sm text-slate-600 font-medium">kg CO‚ÇÇ</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Transport Breakdown -->
            <div class="space-y-4 mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Breakdown by Mode</h4>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <i class="fas fa-car text-red-500 mr-3"></i>
                  <span class="font-medium text-slate-700">Car</span>
                </div>
                <span class="font-bold text-red-600" id="carEmissions">2.8 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <i class="fas fa-bus text-green-500 mr-3"></i>
                  <span class="font-medium text-slate-700">Public Transport</span>
                </div>
                <span class="font-bold text-green-600" id="publicEmissions">0.8 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <i class="fas fa-plane text-blue-500 mr-3"></i>
                  <span class="font-medium text-slate-700">Flights</span>
                </div>
                <span class="font-bold text-blue-600" id="flightEmissions">0.4 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <i class="fas fa-taxi text-yellow-500 mr-3"></i>
                  <span class="font-medium text-slate-700">Ride-share</span>
                </div>
                <span class="font-bold text-yellow-600" id="rideShareEmissions">0.2 kg</span>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
              <div class="flex justify-between text-sm text-slate-600 mb-2">
                <span>Daily Target: 5.0 kg CO‚ÇÇ</span>
                <span id="progressPercentage">84%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500" 
                     id="progressBar" style="width: 84%"></div>
              </div>
            </div>

            <!-- Quick Tips -->
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
              <h4 class="font-bold text-blue-700 mb-2">üí° Quick Tip</h4>
              <p class="text-sm text-blue-600" id="transportTip">
                Taking public transport instead of driving could save you 2.0 kg CO‚ÇÇ today!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Food & Diet Tab -->
    <div id="food" class="tab-content">
      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Input Section -->
        <div class="space-y-8" data-aos="fade-right">
          <div class="bg-white rounded-3xl p-8 shadow-lg border border-orange-100">
            <!-- Section Header -->
            <div class="mb-8">
              <h3 class="text-3xl font-bold text-slate-800 mb-3">
                <i class="fas fa-utensils text-orange-500 mr-3"></i>
                Food & Diet
              </h3>
              <p class="text-lg text-slate-600">Track your meals and discover how your diet impacts your carbon footprint.</p>
            </div>
            
            <!-- Weekly Meal Tracker -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-calendar-week text-green-500 mr-2"></i>
                Weekly Meal Tracker
              </h4>
              
              <!-- Meat Section -->
              <div class="mb-8 bg-red-50 rounded-xl p-6">
                <h5 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
                  <span class="text-2xl mr-2">ü•©</span>
                  Meat
                </h5>
                <div class="space-y-6">
                  <div>
                    <div class="flex justify-between items-center mb-2">
                      <label class="text-sm font-medium text-slate-600">Beef meals per week</label>
                      <div class="flex items-center gap-2">
                        <span class="text-lg font-bold text-red-600" id="beefValue">2</span>
                        <span class="text-sm text-slate-500">meals</span>
                        <span class="text-sm font-semibold text-red-600" id="beefCO2">13.6 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="14" value="2" class="slider w-full" id="beefSlider" 
                           oninput="updateFoodSlider('beef', this.value)">
                  </div>
                  
                  <div>
                    <div class="flex justify-between items-center mb-2">
                      <label class="text-sm font-medium text-slate-600">Chicken meals per week</label>
                      <div class="flex items-center gap-2">
                        <span class="text-lg font-bold text-orange-600" id="chickenValue">4</span>
                        <span class="text-sm text-slate-500">meals</span>
                        <span class="text-sm font-semibold text-orange-600" id="chickenCO2">8.4 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="14" value="4" class="slider w-full" id="chickenSlider" 
                           oninput="updateFoodSlider('chicken', this.value)">
                  </div>
                  
                  <div>
                    <div class="flex justify-between items-center mb-2">
                      <label class="text-sm font-medium text-slate-600">Pork meals per week</label>
                      <div class="flex items-center gap-2">
                        <span class="text-lg font-bold text-pink-600" id="porkValue">1</span>
                        <span class="text-sm text-slate-500">meals</span>
                        <span class="text-sm font-semibold text-pink-600" id="porkCO2">3.2 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="14" value="1" class="slider w-full" id="porkSlider" 
                           oninput="updateFoodSlider('pork', this.value)">
                  </div>
                </div>
              </div>

              <!-- Dairy Section -->
              <div class="mb-8 bg-blue-50 rounded-xl p-6">
                <h5 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
                  <span class="text-2xl mr-2">ü•õ</span>
                  Dairy
                </h5>
                <div class="space-y-6">
                  <div>
                    <div class="flex justify-between items-center mb-2">
                      <label class="text-sm font-medium text-slate-600">Milk servings per week</label>
                      <div class="flex items-center gap-2">
                        <span class="text-lg font-bold text-blue-600" id="milkValue">7</span>
                        <span class="text-sm text-slate-500">servings</span>
                        <span class="text-sm font-semibold text-blue-600" id="milkCO2">2.1 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="21" value="7" class="slider w-full" id="milkSlider" 
                           oninput="updateFoodSlider('milk', this.value)">
                  </div>
                  
                  <div>
                    <div class="flex justify-between items-center mb-2">
                      <label class="text-sm font-medium text-slate-600">Cheese servings per week</label>
                      <div class="flex items-center gap-2">
                        <span class="text-lg font-bold text-yellow-600" id="cheeseValue">3</span>
                        <span class="text-sm text-slate-500">servings</span>
                        <span class="text-sm font-semibold text-yellow-600" id="cheeseCO2">2.7 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="14" value="3" class="slider w-full" id="cheeseSlider" 
                           oninput="updateFoodSlider('cheese', this.value)">
                  </div>
                </div>
              </div>

              <!-- Vegetarian/Vegan Section -->
              <div class="mb-8 bg-green-50 rounded-xl p-6">
                <h5 class="text-lg font-semibold text-slate-700 mb-4 flex items-center">
                  <span class="text-2xl mr-2">ü•¶</span>
                  Plant-Based
                </h5>
                <div>
                  <div class="flex justify-between items-center mb-2">
                    <label class="text-sm font-medium text-slate-600">Vegetarian/Vegan meals per week</label>
                    <div class="flex items-center gap-2">
                      <span class="text-lg font-bold text-green-600" id="vegValue">7</span>
                      <span class="text-sm text-slate-500">meals</span>
                      <span class="text-sm font-semibold text-green-600" id="vegCO2">1.4 kg CO‚ÇÇ</span>
                    </div>
                  </div>
                  <input type="range" min="0" max="21" value="7" class="slider w-full" id="vegSlider" 
                         oninput="updateFoodSlider('veg', this.value)">
                </div>
              </div>
            </div>

            <!-- Dish Carbon Calculator -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-calculator text-purple-500 mr-2"></i>
                Dish Carbon Calculator
              </h4>
              <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6">
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                  <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-slate-600 mb-2">Enter a dish name</label>
                    <input type="text" placeholder="e.g., butter chicken, beef burger, quinoa salad" 
                           class="form-input" id="dishInput" oninput="calculateDishCarbon()">
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Meal type</label>
                    <select class="form-select" id="mealType" onchange="calculateDishCarbon()">
                      <option value="breakfast">Breakfast</option>
                      <option value="lunch" selected>Lunch</option>
                      <option value="dinner">Dinner</option>
                    </select>
                  </div>
                </div>
                <div class="text-center p-4 bg-white rounded-lg">
                  <div class="text-2xl font-bold text-purple-600" id="dishCarbon">0.0</div>
                  <div class="text-sm text-slate-600">Estimated footprint: kg CO‚ÇÇ/meal</div>
                </div>
              </div>
            </div>

            <!-- Restaurant vs Home-Cooked -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-home text-blue-500 mr-2"></i>
                Cooking Style
              </h4>
              <div class="bg-blue-50 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                  <span class="font-medium text-slate-700">Mostly Home-Cooked</span>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" id="cookingToggle" onchange="toggleCookingStyle()">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-orange-600"></div>
                  </label>
                  <span class="font-medium text-slate-700">Mostly Restaurant</span>
                </div>
                <p class="text-sm text-slate-600 text-center" id="cookingImpact">
                  Home-cooked meals typically have 20% lower carbon footprint
                </p>
              </div>
            </div>

            <!-- Local vs Imported -->
            <div class="mb-8">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-map-marker-alt text-green-500 mr-2"></i>
                Produce Source
              </h4>
              <div class="bg-green-50 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                  <span class="font-medium text-slate-700">Local Produce</span>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" id="produceToggle" onchange="toggleProduceSource()">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                  </label>
                  <span class="font-medium text-slate-700">Imported Produce</span>
                </div>
                <p class="text-sm text-slate-600 text-center" id="produceImpact">
                  Local produce reduces transport emissions by up to 30%
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Real-Time Food Feedback -->
        <div class="sticky top-8" data-aos="fade-left">
          <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-3xl p-8 shadow-xl border border-orange-200">
            <!-- Results Card Header -->
            <div class="text-center mb-8">
              <h3 class="text-2xl font-bold text-slate-800 mb-2">Weekly Diet Impact</h3>
              <p class="text-lg text-orange-600 font-semibold" id="foodResultText">
                Your weekly diet contributes <span id="foodWeeklyEmissions">31.4</span> kg CO‚ÇÇ
              </p>
            </div>
            
            <!-- Circular Progress Gauge -->
            <div class="mb-8 flex justify-center">
              <div class="relative w-48 h-48">
                <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 100 100">
                  <!-- Background circle -->
                  <circle cx="50" cy="50" r="40" stroke="#fed7aa" stroke-width="8" fill="none"/>
                  <!-- Progress circle -->
                  <circle cx="50" cy="50" r="40" stroke="url(#foodGradient)" stroke-width="8" fill="none"
                          stroke-dasharray="251.2" stroke-dashoffset="125.6" 
                          id="foodProgressCircle" class="transition-all duration-500 ease-out"/>
                  <!-- Gradient definition -->
                  <defs>
                    <linearGradient id="foodGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#f97316"/>
                      <stop offset="100%" style="stop-color:#dc2626"/>
                    </linearGradient>
                  </defs>
                </svg>
                <!-- Center content -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center">
                    <div class="text-3xl font-black text-orange-600" id="foodGaugeValue">31.4</div>
                    <div class="text-sm text-slate-600 font-medium">kg CO‚ÇÇ</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Food Category Breakdown -->
            <div class="space-y-4 mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Breakdown by Category</h4>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">ü•©</span>
                  <span class="font-medium text-slate-700">Meat</span>
                </div>
                <span class="font-bold text-red-600" id="meatTotalEmissions">25.2 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">ü•õ</span>
                  <span class="font-medium text-slate-700">Dairy</span>
                </div>
                <span class="font-bold text-blue-600" id="dairyTotalEmissions">4.8 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">ü•¶</span>
                  <span class="font-medium text-slate-700">Plant-Based</span>
                </div>
                <span class="font-bold text-green-600" id="vegTotalEmissions">1.4 kg</span>
              </div>
            </div>

            <!-- Food Pie Chart -->
            <div class="mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Emissions Distribution</h4>
              <div class="relative w-32 h-32 mx-auto">
                <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 42 42">
                  <!-- Meat slice (largest) -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#dc2626" stroke-width="3"
                          stroke-dasharray="60 40" stroke-dashoffset="0" id="meatSlice"/>
                  <!-- Dairy slice -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#2563eb" stroke-width="3"
                          stroke-dasharray="15 85" stroke-dashoffset="-60" id="dairySlice"/>
                  <!-- Veg slice -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#16a34a" stroke-width="3"
                          stroke-dasharray="5 95" stroke-dashoffset="-75" id="vegSlice"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span class="text-xs font-semibold text-slate-600">Diet Mix</span>
                </div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
              <div class="flex justify-between text-sm text-slate-600 mb-2">
                <span>Weekly Target: 35.0 kg CO‚ÇÇ</span>
                <span id="foodProgressPercentage">90%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-orange-500 to-red-500 h-3 rounded-full transition-all duration-500" 
                     id="foodProgressBar" style="width: 90%"></div>
              </div>
            </div>

            <!-- Quick Tips -->
            <div class="bg-orange-50 border border-orange-200 rounded-xl p-4">
              <h4 class="font-bold text-orange-700 mb-2">üå± Diet Tip</h4>
              <p class="text-sm text-orange-600" id="foodTip">
                Replacing 1 beef meal with a plant-based option could save 6.8 kg CO‚ÇÇ per week!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Energy Usage Tab -->
    <div id="energy" class="tab-content">
      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Input Section -->
        <div class="space-y-8" data-aos="fade-right">
          <div class="bg-white rounded-3xl p-8 shadow-lg border border-yellow-100">
            <!-- Section Header -->
            <div class="mb-8">
              <h3 class="text-3xl font-bold text-slate-800 mb-3">
                <i class="fas fa-plug text-yellow-500 mr-3"></i>
                Energy & Utilities
              </h3>
              <p class="text-lg text-slate-600">Log your household energy usage or upload your bills ‚Äî our AI calculates your carbon footprint automatically.</p>
            </div>
            
            <!-- Input Method Toggle -->
            <div class="mb-10">
              <div class="flex bg-gray-100 rounded-xl p-1">
                <button class="flex-1 py-3 px-6 rounded-lg font-semibold transition-all duration-300 energy-tab-btn active" 
                        onclick="switchEnergyTab('manual')" id="manualTabBtn">
                  <i class="fas fa-keyboard mr-2"></i>
                  Manual Entry
                </button>
                <button class="flex-1 py-3 px-6 rounded-lg font-semibold transition-all duration-300 energy-tab-btn" 
                        onclick="switchEnergyTab('upload')" id="uploadTabBtn">
                  <i class="fas fa-upload mr-2"></i>
                  Upload Bill
                </button>
              </div>
            </div>

            <!-- Manual Entry Tab -->
            <div id="manualEntry" class="energy-tab-content active">
              <!-- Electricity Consumption -->
              <div class="mb-10">
                <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">‚ö°</span>
                  Electricity Consumption
                </h4>
                <div class="bg-yellow-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Electricity used per month (kWh)</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-yellow-600" id="electricityValue">300</span>
                        <span class="text-sm text-slate-500">kWh</span>
                        <span class="text-sm font-semibold text-yellow-600" id="electricityCO2">180.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="1000" value="300" class="slider w-full mb-3" id="electricitySlider" 
                           oninput="updateEnergySlider('electricity', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 kWh</span>
                      <span>1000 kWh</span>
                    </div>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (kWh)</label>
                      <input type="number" min="0" max="1000" value="300" class="form-input" id="electricityInput" 
                             oninput="updateEnergyFromInput('electricity', this.value)">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Electricity Source</label>
                      <select class="form-select" id="electricitySource" onchange="updateEnergyCalculation()">
                        <option value="grid">Grid (Mixed)</option>
                        <option value="coal">Coal Power</option>
                        <option value="gas">Natural Gas</option>
                        <option value="renewable">Renewable</option>
                        <option value="solar">Solar Panels</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Heating & Cooling -->
              <div class="mb-10">
                <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üî•</span>
                  Heating & Cooling
                </h4>
                <div class="bg-red-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">AC/Heater usage per day (hours)</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-red-600" id="heatingValue">6</span>
                        <span class="text-sm text-slate-500">hrs/day</span>
                        <span class="text-sm font-semibold text-red-600" id="heatingCO2">54.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="24" value="6" class="slider w-full mb-3" id="heatingSlider" 
                           oninput="updateEnergySlider('heating', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 hrs</span>
                      <span>24 hrs</span>
                    </div>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (hours)</label>
                      <input type="number" min="0" max="24" value="6" class="form-input" id="heatingInput" 
                             oninput="updateEnergyFromInput('heating', this.value)">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Type</label>
                      <select class="form-select" id="heatingType" onchange="updateEnergyCalculation()">
                        <option value="electric">Electric</option>
                        <option value="gas">Gas</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Gas/Fuel Usage -->
              <div class="mb-10">
                <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üè†</span>
                  Gas / Fuel Usage
                </h4>
                <div class="bg-blue-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Gas cylinder / LPG per month (kg)</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-blue-600" id="gasValue">15</span>
                        <span class="text-sm text-slate-500">kg</span>
                        <span class="text-sm font-semibold text-blue-600" id="gasCO2">45.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="50" value="15" class="slider w-full mb-3" id="gasSlider" 
                           oninput="updateEnergySlider('gas', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 kg</span>
                      <span>50 kg</span>
                    </div>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (kg)</label>
                    <input type="number" min="0" max="50" value="15" class="form-input w-32" id="gasInput" 
                           oninput="updateEnergyFromInput('gas', this.value)">
                  </div>
                </div>
              </div>

              <!-- Renewable Energy -->
              <div class="mb-8">
                <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üå±</span>
                  Renewable Energy Options
                </h4>
                <div class="bg-green-50 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-4">
                    <span class="font-medium text-slate-700">Do you use solar/wind energy?</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" class="sr-only peer" id="renewableToggle" onchange="toggleRenewable()">
                      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                  </div>
                  <p class="text-sm text-slate-600 text-center" id="renewableImpact">
                    Renewable energy can reduce your carbon footprint by up to 80%
                  </p>
                </div>
              </div>
            </div>

            <!-- Upload Bill Tab -->
            <div id="uploadBill" class="energy-tab-content hidden">
              <!-- Drag & Drop Area -->
              <div class="mb-8">
                <div class="drag-drop-area border-2 border-dashed border-yellow-300 rounded-xl p-8 text-center bg-yellow-50 hover:bg-yellow-100 transition-colors cursor-pointer" 
                     id="energyDropArea" onclick="document.getElementById('energyFileInput').click()">
                  <div class="mb-4">
                    <i class="fas fa-file-upload text-6xl text-yellow-500 mb-4"></i>
                    <h4 class="text-xl font-semibold text-slate-700 mb-2">Drop your energy bills here</h4>
                    <p class="text-slate-500 mb-4">or click to browse files</p>
                    <div class="text-sm text-slate-400">Supports PDF, JPG, PNG files</div>
                  </div>
                  <input type="file" id="energyFileInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;" onchange="handleEnergyFiles(this.files)">
                </div>
              </div>

              <!-- Upload Progress -->
              <div id="energyUploadProgress" class="hidden mb-8">
                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-medium text-yellow-700">
                      <i class="fas fa-robot mr-2"></i>
                      AI Processing...
                    </span>
                    <span class="text-sm text-yellow-600" id="energyProgressText">0%</span>
                  </div>
                  <div class="w-full bg-yellow-200 rounded-full h-3">
                    <div class="bg-yellow-600 h-3 rounded-full transition-all duration-300" id="energyProgressBar" style="width: 0%"></div>
                  </div>
                  <p class="text-xs text-yellow-600 mt-2">Extracting electricity usage, gas consumption, and billing period...</p>
                </div>
              </div>

              <!-- Uploaded Files List -->
              <div id="energyUploadedFiles" class="hidden mb-8">
                <h4 class="text-lg font-semibold text-slate-700 mb-4">Uploaded Files</h4>
                <div id="energyFilesList" class="space-y-3">
                  <!-- Files will be added here dynamically -->
                </div>
              </div>

              <!-- AI Extracted Data -->
              <div id="energyExtractedData" class="hidden">
                <h4 class="text-lg font-semibold text-slate-700 mb-4">
                  <i class="fas fa-magic mr-2 text-purple-500"></i>
                  AI Extracted Data
                </h4>
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                  <p class="text-sm text-purple-600 mb-4">
                    <i class="fas fa-info-circle mr-1"></i>
                    Review and edit the extracted values if needed
                  </p>
                  <div class="grid md:grid-cols-3 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Electricity (kWh)</label>
                      <input type="number" class="form-input" id="extractedElectricity" oninput="updateFromExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Gas Usage (kg)</label>
                      <input type="number" class="form-input" id="extractedGas" oninput="updateFromExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Billing Period</label>
                      <input type="text" class="form-input" id="extractedPeriod" readonly>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Real-Time Energy Feedback -->
        <div class="sticky top-8" data-aos="fade-left">
          <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-3xl p-8 shadow-xl border border-yellow-200">
            <!-- Results Card Header -->
            <div class="text-center mb-8">
              <h3 class="text-2xl font-bold text-slate-800 mb-2">Monthly Energy Impact</h3>
              <p class="text-lg text-yellow-600 font-semibold" id="energyResultText">
                Your monthly energy footprint: <span id="energyMonthlyEmissions">279.0</span> kg CO‚ÇÇ
              </p>
            </div>
            
            <!-- Circular Progress Gauge -->
            <div class="mb-8 flex justify-center">
              <div class="relative w-48 h-48">
                <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 100 100">
                  <!-- Background circle -->
                  <circle cx="50" cy="50" r="40" stroke="#fef3c7" stroke-width="8" fill="none"/>
                  <!-- Progress circle -->
                  <circle cx="50" cy="50" r="40" stroke="url(#energyGradient)" stroke-width="8" fill="none"
                          stroke-dasharray="251.2" stroke-dashoffset="100.5" 
                          id="energyProgressCircle" class="transition-all duration-500 ease-out"/>
                  <!-- Gradient definition -->
                  <defs>
                    <linearGradient id="energyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#f59e0b"/>
                      <stop offset="100%" style="stop-color:#dc2626"/>
                    </linearGradient>
                  </defs>
                </svg>
                <!-- Center content -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center">
                    <div class="text-3xl font-black text-yellow-600" id="energyGaugeValue">279.0</div>
                    <div class="text-sm text-slate-600 font-medium">kg CO‚ÇÇ</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Energy Category Breakdown -->
            <div class="space-y-4 mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Breakdown by Source</h4>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">‚ö°</span>
                  <span class="font-medium text-slate-700">Electricity</span>
                </div>
                <span class="font-bold text-yellow-600" id="electricityTotalEmissions">180.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üî•</span>
                  <span class="font-medium text-slate-700">Heating/Cooling</span>
                </div>
                <span class="font-bold text-red-600" id="heatingTotalEmissions">54.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üè†</span>
                  <span class="font-medium text-slate-700">Gas/LPG</span>
                </div>
                <span class="font-bold text-blue-600" id="gasTotalEmissions">45.0 kg</span>
              </div>
            </div>

            <!-- Energy Stacked Bar Chart -->
            <div class="mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Energy Mix</h4>
              <div class="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
                <div class="h-full flex">
                  <div class="bg-yellow-500 transition-all duration-500" id="electricityBar" style="width: 64.5%"></div>
                  <div class="bg-red-500 transition-all duration-500" id="heatingBar" style="width: 19.4%"></div>
                  <div class="bg-blue-500 transition-all duration-500" id="gasBar" style="width: 16.1%"></div>
                </div>
              </div>
              <div class="flex justify-between text-xs text-slate-500 mt-2">
                <span>‚ö° Electricity</span>
                <span>üî• Heating</span>
                <span>üè† Gas</span>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
              <div class="flex justify-between text-sm text-slate-600 mb-2">
                <span>Monthly Target: 350.0 kg CO‚ÇÇ</span>
                <span id="energyProgressPercentage">80%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full transition-all duration-500" 
                     id="energyProgressBar" style="width: 80%"></div>
              </div>
            </div>

            <!-- Quick Tips -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
              <h4 class="font-bold text-yellow-700 mb-2">üí° Energy Tip</h4>
              <p class="text-sm text-yellow-600" id="energyTip">
                Switching to renewable energy could reduce your emissions by 144 kg CO‚ÇÇ per month!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Shopping & Consumption Tab -->
    <div id="shopping" class="tab-content">
      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Input Section -->
        <div class="space-y-8" data-aos="fade-right">
          <div class="bg-white rounded-3xl p-8 shadow-lg border border-purple-100">
            <!-- Section Header -->
            <div class="mb-8">
              <h3 class="text-3xl font-bold text-slate-800 mb-3">
                <i class="fas fa-shopping-cart text-purple-500 mr-3"></i>
                Shopping & Consumption
              </h3>
              <p class="text-lg text-slate-600">Track your purchases and understand how your consumption affects your carbon footprint.</p>
            </div>
            
            <!-- Manual Entry Panel -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-keyboard text-green-500 mr-2"></i>
                Manual Entry
              </h4>

              <!-- Clothing & Fashion -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üëï</span>
                  Clothing & Fashion
                </h5>
                <div class="bg-pink-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Clothing items bought per month</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-pink-600" id="clothingValue">3</span>
                        <span class="text-sm text-slate-500">items</span>
                        <span class="text-sm font-semibold text-pink-600" id="clothingCO2">24.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="20" value="3" class="slider w-full mb-3" id="clothingSlider" 
                           oninput="updateShoppingSlider('clothing', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 items</span>
                      <span>20 items</span>
                    </div>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input</label>
                      <input type="number" min="0" max="20" value="3" class="form-input" id="clothingInput" 
                             oninput="updateShoppingFromInput('clothing', this.value)">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Type</label>
                      <select class="form-select" id="clothingType" onchange="updateShoppingCalculation()">
                        <option value="fast">Fast Fashion</option>
                        <option value="sustainable">Sustainable</option>
                        <option value="secondhand">Second-Hand</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Electronics & Gadgets -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üì±</span>
                  Electronics & Gadgets
                </h5>
                <div class="bg-blue-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Electronics purchased per year</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-blue-600" id="electronicsValue">2</span>
                        <span class="text-sm text-slate-500">items</span>
                        <span class="text-sm font-semibold text-blue-600" id="electronicsCO2">83.3 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="10" value="2" class="slider w-full mb-3" id="electronicsSlider" 
                           oninput="updateShoppingSlider('electronics', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 items</span>
                      <span>10 items</span>
                    </div>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input</label>
                      <input type="number" min="0" max="10" value="2" class="form-input" id="electronicsInput" 
                             oninput="updateShoppingFromInput('electronics', this.value)">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Device Type</label>
                      <select class="form-select" id="electronicsType" onchange="updateShoppingCalculation()">
                        <option value="phone">Phone</option>
                        <option value="laptop">Laptop</option>
                        <option value="tv">TV</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Household Appliances -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üè†</span>
                  Household Appliances
                </h5>
                <div class="bg-green-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Appliance usage per day (hours)</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-green-600" id="appliancesValue">8</span>
                        <span class="text-sm text-slate-500">hrs/day</span>
                        <span class="text-sm font-semibold text-green-600" id="appliancesCO2">36.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="24" value="8" class="slider w-full mb-3" id="appliancesSlider" 
                           oninput="updateShoppingSlider('appliances', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 hrs</span>
                      <span>24 hrs</span>
                    </div>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (hours)</label>
                      <input type="number" min="0" max="24" value="8" class="form-input" id="appliancesInput" 
                             oninput="updateShoppingFromInput('appliances', this.value)">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Category</label>
                      <select class="form-select" id="appliancesType" onchange="updateShoppingCalculation()">
                        <option value="fridge">Fridge</option>
                        <option value="washing">Washing Machine</option>
                        <option value="ac">Air Conditioner</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Online Deliveries -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üì¶</span>
                  Online Deliveries / E-commerce
                </h5>
                <div class="bg-orange-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Packages delivered per month</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-orange-600" id="deliveriesValue">8</span>
                        <span class="text-sm text-slate-500">packages</span>
                        <span class="text-sm font-semibold text-orange-600" id="deliveriesCO2">16.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="30" value="8" class="slider w-full mb-3" id="deliveriesSlider" 
                           oninput="updateShoppingSlider('deliveries', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 packages</span>
                      <span>30 packages</span>
                    </div>
                  </div>
                  
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input</label>
                      <input type="number" min="0" max="30" value="8" class="form-input" id="deliveriesInput" 
                             oninput="updateShoppingFromInput('deliveries', this.value)">
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-sm font-medium text-slate-600">Eco-friendly delivery preferred?</span>
                      <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" id="ecoDeliveryToggle" onchange="toggleEcoDelivery()">
                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Upload Bill/Receipt Panel -->
            <div class="mb-8">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-upload text-purple-500 mr-2"></i>
                Upload Bill / Receipt (Optional)
              </h4>
              
              <!-- Drag & Drop Area -->
              <div class="mb-8">
                <div class="drag-drop-area border-2 border-dashed border-purple-300 rounded-xl p-8 text-center bg-purple-50 hover:bg-purple-100 transition-colors cursor-pointer" 
                     id="shoppingDropArea" onclick="document.getElementById('shoppingFileInput').click()">
                  <div class="mb-4">
                    <i class="fas fa-receipt text-6xl text-purple-500 mb-4"></i>
                    <h4 class="text-xl font-semibold text-slate-700 mb-2">Drop your shopping receipts here</h4>
                    <p class="text-slate-500 mb-4">or click to browse files</p>
                    <div class="text-sm text-slate-400">Supports PDF, JPG, PNG files</div>
                  </div>
                  <input type="file" id="shoppingFileInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;" onchange="handleShoppingFiles(this.files)">
                </div>
              </div>

              <!-- Upload Progress -->
              <div id="shoppingUploadProgress" class="hidden mb-8">
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-medium text-purple-700">
                      <i class="fas fa-robot mr-2"></i>
                      AI Processing Receipt...
                    </span>
                    <span class="text-sm text-purple-600" id="shoppingProgressText">0%</span>
                  </div>
                  <div class="w-full bg-purple-200 rounded-full h-3">
                    <div class="bg-purple-600 h-3 rounded-full transition-all duration-300" id="shoppingProgressBar" style="width: 0%"></div>
                  </div>
                  <p class="text-xs text-purple-600 mt-2">Extracting item types, quantities, and estimating emissions...</p>
                </div>
              </div>

              <!-- AI Extracted Data -->
              <div id="shoppingExtractedData" class="hidden">
                <h4 class="text-lg font-semibold text-slate-700 mb-4">
                  <i class="fas fa-magic mr-2 text-purple-500"></i>
                  AI Extracted Data
                </h4>
                <div class="bg-purple-50 border border-purple-200 rounded-xl p-6">
                  <p class="text-sm text-purple-600 mb-4">
                    <i class="fas fa-info-circle mr-1"></i>
                    Review and adjust the extracted values if needed
                  </p>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Clothing Items</label>
                      <input type="number" class="form-input" id="extractedClothing" oninput="updateFromShoppingExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Electronics</label>
                      <input type="number" class="form-input" id="extractedElectronics" oninput="updateFromShoppingExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Household Items</label>
                      <input type="number" class="form-input" id="extractedHousehold" oninput="updateFromShoppingExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Total Amount</label>
                      <input type="text" class="form-input" id="extractedAmount" readonly>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Real-Time Shopping Feedback -->
        <div class="sticky top-8" data-aos="fade-left">
          <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-3xl p-8 shadow-xl border border-purple-200">
            <!-- Results Card Header -->
            <div class="text-center mb-8">
              <h3 class="text-2xl font-bold text-slate-800 mb-2">Monthly Consumption Impact</h3>
              <p class="text-lg text-purple-600 font-semibold" id="shoppingResultText">
                Your monthly consumption footprint: <span id="shoppingMonthlyEmissions">159.3</span> kg CO‚ÇÇ
              </p>
            </div>
            
            <!-- Circular Progress Gauge -->
            <div class="mb-8 flex justify-center">
              <div class="relative w-48 h-48">
                <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 100 100">
                  <!-- Background circle -->
                  <circle cx="50" cy="50" r="40" stroke="#f3e8ff" stroke-width="8" fill="none"/>
                  <!-- Progress circle -->
                  <circle cx="50" cy="50" r="40" stroke="url(#shoppingGradient)" stroke-width="8" fill="none"
                          stroke-dasharray="251.2" stroke-dashoffset="125.6" 
                          id="shoppingProgressCircle" class="transition-all duration-500 ease-out"/>
                  <!-- Gradient definition -->
                  <defs>
                    <linearGradient id="shoppingGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#a855f7"/>
                      <stop offset="100%" style="stop-color:#ec4899"/>
                    </linearGradient>
                  </defs>
                </svg>
                <!-- Center content -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center">
                    <div class="text-3xl font-black text-purple-600" id="shoppingGaugeValue">159.3</div>
                    <div class="text-sm text-slate-600 font-medium">kg CO‚ÇÇ</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Shopping Category Breakdown -->
            <div class="space-y-4 mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Breakdown by Category</h4>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üëï</span>
                  <span class="font-medium text-slate-700">Clothing</span>
                </div>
                <span class="font-bold text-pink-600" id="clothingTotalEmissions">24.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üì±</span>
                  <span class="font-medium text-slate-700">Electronics</span>
                </div>
                <span class="font-bold text-blue-600" id="electronicsTotalEmissions">83.3 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üè†</span>
                  <span class="font-medium text-slate-700">Appliances</span>
                </div>
                <span class="font-bold text-green-600" id="appliancesTotalEmissions">36.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üì¶</span>
                  <span class="font-medium text-slate-700">Deliveries</span>
                </div>
                <span class="font-bold text-orange-600" id="deliveriesTotalEmissions">16.0 kg</span>
              </div>
            </div>

            <!-- Shopping Hotspots -->
            <div class="mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Shopping Hotspots</h4>
              <div class="bg-red-50 border border-red-200 rounded-xl p-4">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm font-medium text-red-700">üî• Top Contributor</span>
                  <span class="text-sm font-bold text-red-600" id="topContributor">Electronics (52%)</span>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-orange-700">üî∏ Second Highest</span>
                  <span class="text-sm font-bold text-orange-600" id="secondContributor">Appliances (23%)</span>
                </div>
              </div>
            </div>

            <!-- Shopping Pie Chart -->
            <div class="mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Consumption Distribution</h4>
              <div class="relative w-32 h-32 mx-auto">
                <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 42 42">
                  <!-- Electronics slice (largest) -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#3b82f6" stroke-width="3"
                          stroke-dasharray="52 48" stroke-dashoffset="0" id="electronicsSlice"/>
                  <!-- Appliances slice -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#16a34a" stroke-width="3"
                          stroke-dasharray="23 77" stroke-dashoffset="-52" id="appliancesSlice"/>
                  <!-- Clothing slice -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#ec4899" stroke-width="3"
                          stroke-dasharray="15 85" stroke-dashoffset="-75" id="clothingSlice"/>
                  <!-- Deliveries slice -->
                  <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#f97316" stroke-width="3"
                          stroke-dasharray="10 90" stroke-dashoffset="-90" id="deliveriesSlice"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span class="text-xs font-semibold text-slate-600">Shopping</span>
                </div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
              <div class="flex justify-between text-sm text-slate-600 mb-2">
                <span>Monthly Target: 200.0 kg CO‚ÇÇ</span>
                <span id="shoppingProgressPercentage">80%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-500" 
                     id="shoppingProgressBar" style="width: 80%"></div>
              </div>
            </div>

            <!-- Quick Tips -->
            <div class="bg-purple-50 border border-purple-200 rounded-xl p-4">
              <h4 class="font-bold text-purple-700 mb-2">üõçÔ∏è Shopping Tip</h4>
              <p class="text-sm text-purple-600" id="shoppingTip">
                Choosing second-hand clothing could reduce your fashion footprint by 80%!
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Waste & Recycling Tab -->
    <div id="waste" class="tab-content">
      <div class="grid lg:grid-cols-2 gap-12">
        <!-- Input Section -->
        <div class="space-y-8" data-aos="fade-right">
          <div class="bg-white rounded-3xl p-8 shadow-lg border border-green-100">
            <!-- Section Header -->
            <div class="mb-8">
              <h3 class="text-3xl font-bold text-slate-800 mb-3">
                <i class="fas fa-recycle text-green-500 mr-3"></i>
                Waste & Recycling
              </h3>
              <p class="text-lg text-slate-600">Track your waste generation and recycling habits to understand your environmental impact.</p>
            </div>
            
            <!-- Manual Entry Panel -->
            <div class="mb-10">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-keyboard text-green-500 mr-2"></i>
                Manual Entry
              </h4>

              <!-- Plastic Waste -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">ü•§</span>
                  Plastic Waste
                </h5>
                <div class="bg-red-50 rounded-xl p-6">
                  <div class="mb-6">
                    <div class="flex justify-between items-center mb-3">
                      <label class="text-sm font-medium text-slate-600">Plastic waste generated per week (kg)</label>
                      <div class="flex items-center gap-2">
                        <span class="text-2xl font-bold text-red-600" id="plasticValue">2.5</span>
                        <span class="text-sm text-slate-500">kg</span>
                        <span class="text-sm font-semibold text-red-600" id="plasticCO2">15.0 kg CO‚ÇÇ</span>
                      </div>
                    </div>
                    <input type="range" min="0" max="10" step="0.1" value="2.5" class="slider w-full mb-3" id="plasticSlider" 
                           oninput="updateWasteSlider('plastic', this.value)">
                    <div class="flex justify-between text-xs text-slate-500">
                      <span>0 kg</span>
                      <span>10 kg</span>
                    </div>
                  </div>
                  
                  <div>
                    <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (kg)</label>
                    <input type="number" min="0" max="10" step="0.1" value="2.5" class="form-input w-32" id="plasticInput" 
                           oninput="updateWasteFromInput('plastic', this.value)">
                  </div>
                </div>
              </div>

              <!-- Paper/Cardboard Recycling -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üìÑ</span>
                  Paper / Cardboard Recycling
                </h5>
                <div class="bg-blue-50 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-6">
                    <span class="font-medium text-slate-700">Do you recycle paper?</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" class="sr-only peer" id="paperToggle" onchange="togglePaperRecycling()">
                      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                  </div>
                  
                  <div id="paperRecyclingInput" class="hidden">
                    <div class="mb-4">
                      <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-medium text-slate-600">Amount recycled per week (kg)</label>
                        <div class="flex items-center gap-2">
                          <span class="text-2xl font-bold text-blue-600" id="paperValue">3.0</span>
                          <span class="text-sm text-slate-500">kg</span>
                          <span class="text-sm font-semibold text-green-600" id="paperCO2">-9.0 kg CO‚ÇÇ</span>
                        </div>
                      </div>
                      <input type="range" min="0" max="15" step="0.1" value="3.0" class="slider w-full mb-3" id="paperSlider" 
                             oninput="updateWasteSlider('paper', this.value)">
                      <div class="flex justify-between text-xs text-slate-500">
                        <span>0 kg</span>
                        <span>15 kg</span>
                      </div>
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (kg)</label>
                      <input type="number" min="0" max="15" step="0.1" value="3.0" class="form-input w-32" id="paperInput" 
                             oninput="updateWasteFromInput('paper', this.value)">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Glass/Metal Recycling -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üçæ</span>
                  Glass / Metal Recycling
                </h5>
                <div class="bg-purple-50 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-6">
                    <span class="font-medium text-slate-700">Do you recycle glass/metal?</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" class="sr-only peer" id="glassToggle" onchange="toggleGlassRecycling()">
                      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                  </div>
                  
                  <div id="glassRecyclingInput" class="hidden">
                    <div class="mb-4">
                      <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-medium text-slate-600">Quantity recycled per week (kg)</label>
                        <div class="flex items-center gap-2">
                          <span class="text-2xl font-bold text-purple-600" id="glassValue">1.5</span>
                          <span class="text-sm text-slate-500">kg</span>
                          <span class="text-sm font-semibold text-green-600" id="glassCO2">-6.0 kg CO‚ÇÇ</span>
                        </div>
                      </div>
                      <input type="range" min="0" max="10" step="0.1" value="1.5" class="slider w-full mb-3" id="glassSlider" 
                             oninput="updateWasteSlider('glass', this.value)">
                      <div class="flex justify-between text-xs text-slate-500">
                        <span>0 kg</span>
                        <span>10 kg</span>
                      </div>
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (kg)</label>
                      <input type="number" min="0" max="10" step="0.1" value="1.5" class="form-input w-32" id="glassInput" 
                             oninput="updateWasteFromInput('glass', this.value)">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Composting/Organic Waste -->
              <div class="mb-10">
                <h5 class="text-lg font-semibold text-slate-700 mb-6 flex items-center">
                  <span class="text-2xl mr-2">üóëÔ∏è</span>
                  Composting / Organic Waste
                </h5>
                <div class="bg-green-50 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-6">
                    <span class="font-medium text-slate-700">Do you compost?</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" class="sr-only peer" id="compostToggle" onchange="toggleComposting()">
                      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                  </div>
                  
                  <div id="compostInput" class="hidden">
                    <div class="mb-4">
                      <div class="flex justify-between items-center mb-3">
                        <label class="text-sm font-medium text-slate-600">Amount composted per week (kg)</label>
                        <div class="flex items-center gap-2">
                          <span class="text-2xl font-bold text-green-600" id="compostValue">4.0</span>
                          <span class="text-sm text-slate-500">kg</span>
                          <span class="text-sm font-semibold text-green-600" id="compostCO2">-8.0 kg CO‚ÇÇ</span>
                        </div>
                      </div>
                      <input type="range" min="0" max="20" step="0.1" value="4.0" class="slider w-full mb-3" id="compostSlider" 
                             oninput="updateWasteSlider('compost', this.value)">
                      <div class="flex justify-between text-xs text-slate-500">
                        <span>0 kg</span>
                        <span>20 kg</span>
                      </div>
                    </div>
                    
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Manual Input (kg)</label>
                      <input type="number" min="0" max="20" step="0.1" value="4.0" class="form-input w-32" id="compostInputField" 
                             oninput="updateWasteFromInput('compost', this.value)">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Upload Receipts/Photos Panel -->
            <div class="mb-8">
              <h4 class="text-xl font-semibold text-slate-700 mb-6 flex items-center">
                <i class="fas fa-camera text-green-500 mr-2"></i>
                Upload Receipts / Photos (Optional)
              </h4>
              
              <!-- Drag & Drop Area -->
              <div class="mb-8">
                <div class="drag-drop-area border-2 border-dashed border-green-300 rounded-xl p-8 text-center bg-green-50 hover:bg-green-100 transition-colors cursor-pointer" 
                     id="wasteDropArea" onclick="document.getElementById('wasteFileInput').click()">
                  <div class="mb-4">
                    <i class="fas fa-camera text-6xl text-green-500 mb-4"></i>
                    <h4 class="text-xl font-semibold text-slate-700 mb-2">Drop waste photos or receipts here</h4>
                    <p class="text-slate-500 mb-4">or click to browse files</p>
                    <div class="text-sm text-slate-400">Supports PDF, JPG, PNG files</div>
                  </div>
                  <input type="file" id="wasteFileInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;" onchange="handleWasteFiles(this.files)">
                </div>
              </div>

              <!-- Upload Progress -->
              <div id="wasteUploadProgress" class="hidden mb-8">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                  <div class="flex items-center justify-between mb-3">
                    <span class="text-sm font-medium text-green-700">
                      <i class="fas fa-robot mr-2"></i>
                      AI Analyzing Waste Data...
                    </span>
                    <span class="text-sm text-green-600" id="wasteProgressText">0%</span>
                  </div>
                  <div class="w-full bg-green-200 rounded-full h-3">
                    <div class="bg-green-600 h-3 rounded-full transition-all duration-300" id="wasteProgressBar" style="width: 0%"></div>
                  </div>
                  <p class="text-xs text-green-600 mt-2">Extracting recycled materials, compost amounts, and waste data...</p>
                </div>
              </div>

              <!-- AI Extracted Data -->
              <div id="wasteExtractedData" class="hidden">
                <h4 class="text-lg font-semibold text-slate-700 mb-4">
                  <i class="fas fa-magic mr-2 text-green-500"></i>
                  AI Extracted Data
                </h4>
                <div class="bg-green-50 border border-green-200 rounded-xl p-6">
                  <p class="text-sm text-green-600 mb-4">
                    <i class="fas fa-info-circle mr-1"></i>
                    Review and adjust the extracted values if needed
                  </p>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Plastic Waste (kg)</label>
                      <input type="number" step="0.1" class="form-input" id="extractedPlastic" oninput="updateFromWasteExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Paper Recycled (kg)</label>
                      <input type="number" step="0.1" class="form-input" id="extractedPaper" oninput="updateFromWasteExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Glass/Metal (kg)</label>
                      <input type="number" step="0.1" class="form-input" id="extractedGlass" oninput="updateFromWasteExtracted()">
                    </div>
                    <div>
                      <label class="block text-sm font-medium text-slate-600 mb-2">Compost (kg)</label>
                      <input type="number" step="0.1" class="form-input" id="extractedCompost" oninput="updateFromWasteExtracted()">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Real-Time Waste Feedback -->
        <div class="sticky top-8" data-aos="fade-left">
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-3xl p-8 shadow-xl border border-green-200">
            <!-- Results Card Header -->
            <div class="text-center mb-8">
              <h3 class="text-2xl font-bold text-slate-800 mb-2">Weekly Waste Impact</h3>
              <p class="text-lg text-green-600 font-semibold" id="wasteResultText">
                Your weekly waste footprint: <span id="wasteWeeklyEmissions">-8.0</span> kg CO‚ÇÇ
              </p>
            </div>
            
            <!-- Circular Progress Gauge -->
            <div class="mb-8 flex justify-center">
              <div class="relative w-48 h-48">
                <svg class="w-48 h-48 transform -rotate-90" viewBox="0 0 100 100">
                  <!-- Background circle -->
                  <circle cx="50" cy="50" r="40" stroke="#d1fae5" stroke-width="8" fill="none"/>
                  <!-- Progress circle -->
                  <circle cx="50" cy="50" r="40" stroke="url(#wasteGradient)" stroke-width="8" fill="none"
                          stroke-dasharray="251.2" stroke-dashoffset="201.0" 
                          id="wasteProgressCircle" class="transition-all duration-500 ease-out"/>
                  <!-- Gradient definition -->
                  <defs>
                    <linearGradient id="wasteGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" style="stop-color:#10b981"/>
                      <stop offset="100%" style="stop-color:#059669"/>
                    </linearGradient>
                  </defs>
                </svg>
                <!-- Center content -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="text-center">
                    <div class="text-3xl font-black text-green-600" id="wasteGaugeValue">-8.0</div>
                    <div class="text-sm text-slate-600 font-medium">kg CO‚ÇÇ</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Waste Category Breakdown -->
            <div class="space-y-4 mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Breakdown by Category</h4>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">ü•§</span>
                  <span class="font-medium text-slate-700">Plastic Waste</span>
                </div>
                <span class="font-bold text-red-600" id="plasticTotalEmissions">+15.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üìÑ</span>
                  <span class="font-medium text-slate-700">Paper Recycling</span>
                </div>
                <span class="font-bold text-green-600" id="paperTotalEmissions">-9.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üçæ</span>
                  <span class="font-medium text-slate-700">Glass/Metal</span>
                </div>
                <span class="font-bold text-green-600" id="glassTotalEmissions">-6.0 kg</span>
              </div>
              
              <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
                <div class="flex items-center">
                  <span class="text-2xl mr-3">üóëÔ∏è</span>
                  <span class="font-medium text-slate-700">Composting</span>
                </div>
                <span class="font-bold text-green-600" id="compostTotalEmissions">-8.0 kg</span>
              </div>
            </div>

            <!-- Waste Hotspots -->
            <div class="mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Waste Hotspots</h4>
              <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-3">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-red-700">üî• Largest Impact</span>
                  <span class="text-sm font-bold text-red-600" id="wasteTopContributor">Plastic Waste (+15.0 kg)</span>
                </div>
              </div>
              <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-green-700">üå± Best Saver</span>
                  <span class="text-sm font-bold text-green-600" id="wasteBestSaver">Paper Recycling (-9.0 kg)</span>
                </div>
              </div>
            </div>

            <!-- Waste Stacked Bar Chart -->
            <div class="mb-8">
              <h4 class="text-lg font-semibold text-slate-700 text-center mb-4">Waste Impact Distribution</h4>
              <div class="w-full bg-gray-200 rounded-full h-6 overflow-hidden">
                <div class="h-full flex">
                  <div class="bg-red-500 transition-all duration-500" id="plasticWasteBar" style="width: 50%"></div>
                  <div class="bg-green-500 transition-all duration-500" id="recyclingBar" style="width: 50%"></div>
                </div>
              </div>
              <div class="flex justify-between text-xs text-slate-500 mt-2">
                <span>ü•§ Waste Generated</span>
                <span>‚ôªÔ∏è Recycling Savings</span>
              </div>
            </div>

            <!-- Progress Bar -->
            <div class="mb-6">
              <div class="flex justify-between text-sm text-slate-600 mb-2">
                <span>Weekly Target: -10.0 kg CO‚ÇÇ</span>
                <span id="wasteProgressPercentage">80%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-3">
                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-500" 
                     id="wasteProgressBar" style="width: 80%"></div>
              </div>
            </div>

            <!-- Quick Tips -->
            <div class="bg-green-50 border border-green-200 rounded-xl p-4">
              <h4 class="font-bold text-green-700 mb-2">‚ôªÔ∏è Waste Tip</h4>
              <p class="text-sm text-green-600" id="wasteTip">
                Great job recycling! Reducing plastic use could further improve your waste footprint.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Food Calculator Tab -->
    <div id="calculator" class="tab-content">
      <div class="max-w-4xl mx-auto" data-aos="fade-up">
        <div class="bg-white rounded-3xl p-8 shadow-lg border border-orange-100">
          <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">
            <i class="fas fa-utensils text-orange-500 mr-2"></i>
            Food Carbon Calculator
          </h3>
          
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div>
              <label class="block text-lg font-semibold text-slate-700 mb-4">
                What did you eat?
              </label>
              <input type="text" placeholder="e.g., butter chicken, beef burger, quinoa salad" 
                     class="form-input mb-4" id="foodInput" oninput="calculateFoodCarbon()">
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-slate-600 mb-2">Portion size</label>
                <select class="form-select" id="portionSize">
                  <option value="small">Small</option>
                  <option value="medium" selected>Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>
              
              <button class="btn-primary w-full" onclick="calculateFoodCarbon()">
                <i class="fas fa-calculator"></i>
                Calculate Emissions
              </button>
            </div>
            
            <!-- Results Section -->
            <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6">
              <h4 class="font-bold text-slate-800 mb-4">Emission Estimate</h4>
              
              <div class="text-center mb-6">
                <div class="text-4xl font-black text-orange-600" id="foodCarbonResult">0.0</div>
                <div class="text-sm text-slate-600">kg CO‚ÇÇ equivalent</div>
              </div>
              
              <!-- Food Comparison -->
              <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                  <span>ü•ó Vegan meal</span>
                  <span class="text-green-600">0.5 kg CO‚ÇÇ</span>
                </div>
                <div class="flex justify-between">
                  <span>üêü Fish meal</span>
                  <span class="text-yellow-600">2.1 kg CO‚ÇÇ</span>
                </div>
                <div class="flex justify-between">
                  <span>üêÑ Beef meal</span>
                  <span class="text-red-600">6.8 kg CO‚ÇÇ</span>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-white rounded-lg">
                <p class="text-sm text-slate-600">
                  <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>
                  <strong>Tip:</strong> Choosing plant-based options can reduce your food carbon footprint by up to 70%!
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Initialize AOS
  AOS.init({
    duration: 800,
    once: true,
    offset: 100
  });

  // Tab switching functionality
  function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.remove('active');
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(button => {
      button.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabName).classList.add('active');
    
    // Add active class to clicked button
    event.target.classList.add('active');
  }

  // Transportation-specific functions
  function updateDailyCommute(value) {
    document.getElementById('dailyCommuteValue').textContent = value;
    document.getElementById('dailyCommuteInput').value = value;
    updateTransportCalculation();
  }

  function updateDailyCommuteFromInput(value) {
    if (value >= 0 && value <= 200) {
      document.getElementById('dailyCommuteSlider').value = value;
      document.getElementById('dailyCommuteValue').textContent = value;
      updateTransportCalculation();
    }
  }

  function togglePublicTransport(type) {
    const toggle = document.getElementById(type + 'Toggle');
    const input = document.getElementById(type + 'Km');
    
    if (toggle.checked) {
      input.disabled = false;
      input.focus();
    } else {
      input.disabled = true;
      input.value = '';
    }
    updateTransportCalculation();
  }

  function toggleRideShare() {
    const toggle = document.getElementById('rideShareToggle');
    const input = document.getElementById('rideShareInput');
    
    if (toggle.checked) {
      input.classList.remove('hidden');
      document.getElementById('rideShareKm').focus();
    } else {
      input.classList.add('hidden');
      document.getElementById('rideShareKm').value = '';
    }
    updateTransportCalculation();
  }

  function updateTransportCalculation() {
    // Get all input values
    const dailyCommute = parseFloat(document.getElementById('dailyCommuteSlider').value) || 0;
    const carType = document.getElementById('carType').value;
    const carKmDay = parseFloat(document.getElementById('carKmDay').value) || 0;
    const metroKm = document.getElementById('metroToggle').checked ? (parseFloat(document.getElementById('metroKm').value) || 0) : 0;
    const busKm = document.getElementById('busToggle').checked ? (parseFloat(document.getElementById('busKm').value) || 0) : 0;
    const trainKm = document.getElementById('trainToggle').checked ? (parseFloat(document.getElementById('trainKm').value) || 0) : 0;
    const flightType = document.getElementById('flightType').value;
    const flightTrips = parseFloat(document.getElementById('flightTrips').value) || 0;
    const rideShareKm = document.getElementById('rideShareToggle').checked ? (parseFloat(document.getElementById('rideShareKm').value) || 0) : 0;

    // Carbon emission factors (kg CO2 per km)
    const emissionFactors = {
      petrol: 0.21,
      diesel: 0.24,
      electric: 0.05,
      hybrid: 0.12,
      metro: 0.04,
      bus: 0.08,
      train: 0.06,
      shortFlight: 0.25, // per km
      longFlight: 0.18,  // per km
      rideShare: 0.19
    };

    // Calculate emissions (all now daily values)
    const carEmissions = (dailyCommute + carKmDay) * emissionFactors[carType];
    const publicEmissions = metroKm * emissionFactors.metro + 
                           busKm * emissionFactors.bus + 
                           trainKm * emissionFactors.train;
    
    // Estimate flight distance (short: 500km avg, long: 2000km avg)
    const flightDistance = flightType === 'short' ? 500 : 2000;
    const flightEmissions = (flightTrips * flightDistance * emissionFactors[flightType + 'Flight']) / 365;
    
    const rideShareEmissions = rideShareKm * emissionFactors.rideShare;

    const totalEmissions = carEmissions + publicEmissions + flightEmissions + rideShareEmissions;

    // Update display with smooth animations
    animateValue('transportTodayEmissions', totalEmissions.toFixed(1));
    animateValue('transportGaugeValue', totalEmissions.toFixed(1));
    animateValue('carEmissions', carEmissions.toFixed(1) + ' kg');
    animateValue('publicEmissions', publicEmissions.toFixed(1) + ' kg');
    animateValue('flightEmissions', flightEmissions.toFixed(1) + ' kg');
    animateValue('rideShareEmissions', rideShareEmissions.toFixed(1) + ' kg');

    // Update circular progress gauge
    updateProgressGauge(totalEmissions);
    
    // Update progress bar
    const targetEmissions = 5.0;
    const percentage = Math.min((totalEmissions / targetEmissions) * 100, 100);
    document.getElementById('progressPercentage').textContent = percentage.toFixed(0) + '%';
    document.getElementById('progressBar').style.width = percentage + '%';

    // Update tip
    updateTransportTip(carEmissions, publicEmissions, totalEmissions);
    
    // Update global totals
    updateGlobalTotals();
  }

  function animateValue(elementId, newValue) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    element.style.transition = 'all 0.3s ease';
    element.textContent = newValue;
  }

  function updateProgressGauge(value) {
    const maxValue = 10; // Max expected daily transport emissions
    const percentage = Math.min(value / maxValue, 1);
    const circumference = 251.2; // 2 * œÄ * 40
    const offset = circumference - (percentage * circumference);
    
    const circle = document.getElementById('progressCircle');
    if (circle) {
      circle.style.strokeDashoffset = offset;
    }
  }

  function updateTransportTip(carEmissions, publicEmissions, totalEmissions) {
    const tipElement = document.getElementById('transportTip');
    if (!tipElement) return;
    
    if (carEmissions > publicEmissions && carEmissions > 2) {
      const savings = (carEmissions * 0.7).toFixed(1);
      tipElement.textContent = `Taking public transport instead of driving could save you ${savings} kg CO‚ÇÇ today!`;
    } else if (totalEmissions > 5) {
      tipElement.textContent = 'Consider combining trips or working from home to reduce your transport footprint.';
    } else {
      tipElement.textContent = 'Great job! Your transport emissions are within the sustainable range.';
    }
  }

  function updateGlobalTotals() {
    // This would update the header stats
    const transportEmissions = parseFloat(document.getElementById('transportTodayEmissions').textContent) || 0;
    document.getElementById('todayTotal').textContent = transportEmissions.toFixed(1);
  }

  function toggleTooltip() {
    const tooltip = document.getElementById('tooltip');
    tooltip.classList.toggle('opacity-0');
    tooltip.classList.toggle('invisible');
  }

  // Food tracking functions
  function updateFoodSlider(type, value) {
    document.getElementById(type + 'Value').textContent = value;
    updateFoodCalculation();
  }

  function updateFoodCalculation() {
    // Get all food input values
    const beef = parseFloat(document.getElementById('beefSlider').value) || 0;
    const chicken = parseFloat(document.getElementById('chickenSlider').value) || 0;
    const pork = parseFloat(document.getElementById('porkSlider').value) || 0;
    const milk = parseFloat(document.getElementById('milkSlider').value) || 0;
    const cheese = parseFloat(document.getElementById('cheeseSlider').value) || 0;
    const veg = parseFloat(document.getElementById('vegSlider').value) || 0;

    // Carbon emission factors (kg CO2 per meal/serving)
    const foodEmissionFactors = {
      beef: 6.8,      // kg CO2 per meal
      chicken: 2.1,   // kg CO2 per meal
      pork: 3.2,      // kg CO2 per meal
      milk: 0.3,      // kg CO2 per serving
      cheese: 0.9,    // kg CO2 per serving
      veg: 0.2        // kg CO2 per meal
    };

    // Get modifiers
    const isRestaurant = document.getElementById('cookingToggle').checked;
    const isImported = document.getElementById('produceToggle').checked;
    
    const restaurantMultiplier = isRestaurant ? 1.2 : 1.0; // 20% higher for restaurant
    const importMultiplier = isImported ? 1.3 : 1.0; // 30% higher for imported

    // Calculate emissions for each category
    const beefEmissions = beef * foodEmissionFactors.beef * restaurantMultiplier * importMultiplier;
    const chickenEmissions = chicken * foodEmissionFactors.chicken * restaurantMultiplier * importMultiplier;
    const porkEmissions = pork * foodEmissionFactors.pork * restaurantMultiplier * importMultiplier;
    const milkEmissions = milk * foodEmissionFactors.milk * importMultiplier;
    const cheeseEmissions = cheese * foodEmissionFactors.cheese * importMultiplier;
    const vegEmissions = veg * foodEmissionFactors.veg * importMultiplier;

    // Update individual CO2 displays
    animateValue('beefCO2', beefEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('chickenCO2', chickenEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('porkCO2', porkEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('milkCO2', milkEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('cheeseCO2', cheeseEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('vegCO2', vegEmissions.toFixed(1) + ' kg CO‚ÇÇ');

    // Calculate totals by category
    const meatTotal = beefEmissions + chickenEmissions + porkEmissions;
    const dairyTotal = milkEmissions + cheeseEmissions;
    const vegTotal = vegEmissions;
    const grandTotal = meatTotal + dairyTotal + vegTotal;

    // Update category totals
    animateValue('meatTotalEmissions', meatTotal.toFixed(1) + ' kg');
    animateValue('dairyTotalEmissions', dairyTotal.toFixed(1) + ' kg');
    animateValue('vegTotalEmissions', vegTotal.toFixed(1) + ' kg');

    // Update main displays
    animateValue('foodWeeklyEmissions', grandTotal.toFixed(1));
    animateValue('foodGaugeValue', grandTotal.toFixed(1));

    // Update progress gauge
    updateFoodProgressGauge(grandTotal);
    
    // Update progress bar
    const weeklyTarget = 35.0;
    const percentage = Math.min((grandTotal / weeklyTarget) * 100, 100);
    document.getElementById('foodProgressPercentage').textContent = percentage.toFixed(0) + '%';
    document.getElementById('foodProgressBar').style.width = percentage + '%';

    // Update pie chart
    updateFoodPieChart(meatTotal, dairyTotal, vegTotal);

    // Update tip
    updateFoodTip(beef, chicken, meatTotal, grandTotal);
  }

  function updateFoodProgressGauge(value) {
    const maxValue = 50; // Max expected weekly food emissions
    const percentage = Math.min(value / maxValue, 1);
    const circumference = 251.2; // 2 * œÄ * 40
    const offset = circumference - (percentage * circumference);
    
    const circle = document.getElementById('foodProgressCircle');
    if (circle) {
      circle.style.strokeDashoffset = offset;
    }
  }

  function updateFoodPieChart(meat, dairy, veg) {
    const total = meat + dairy + veg || 1;
    const meatPercent = (meat / total) * 100;
    const dairyPercent = (dairy / total) * 100;
    const vegPercent = (veg / total) * 100;

    // Update pie chart slices
    const circumference = 100; // Simplified for percentage
    
    document.getElementById('meatSlice').style.strokeDasharray = `${meatPercent} ${100 - meatPercent}`;
    document.getElementById('dairySlice').style.strokeDasharray = `${dairyPercent} ${100 - dairyPercent}`;
    document.getElementById('dairySlice').style.strokeDashoffset = `-${meatPercent}`;
    document.getElementById('vegSlice').style.strokeDasharray = `${vegPercent} ${100 - vegPercent}`;
    document.getElementById('vegSlice').style.strokeDashoffset = `-${meatPercent + dairyPercent}`;
  }

  function updateFoodTip(beef, chicken, meatTotal, grandTotal) {
    const tipElement = document.getElementById('foodTip');
    if (!tipElement) return;
    
    if (beef > 3) {
      const savings = (beef * 6.8 * 0.8).toFixed(1);
      tipElement.textContent = `Replacing 1 beef meal with a plant-based option could save ${savings} kg CO‚ÇÇ per week!`;
    } else if (meatTotal > grandTotal * 0.7) {
      tipElement.textContent = 'Consider adding more plant-based meals to reduce your food carbon footprint.';
    } else if (grandTotal < 20) {
      tipElement.textContent = 'Excellent! Your diet has a relatively low carbon footprint.';
    } else {
      tipElement.textContent = 'Try choosing local, seasonal produce to further reduce your food emissions.';
    }
  }

  function calculateDishCarbon() {
    const dish = document.getElementById('dishInput').value.toLowerCase();
    const mealType = document.getElementById('mealType').value;
    
    // Enhanced food carbon database
    const dishDatabase = {
      'beef': 6.8, 'burger': 5.2, 'steak': 7.5, 'meatball': 4.8,
      'chicken': 2.1, 'turkey': 2.3, 'duck': 3.1,
      'pork': 3.2, 'bacon': 4.1, 'ham': 3.5, 'sausage': 3.8,
      'fish': 1.8, 'salmon': 2.2, 'tuna': 1.9, 'shrimp': 2.8,
      'cheese': 2.8, 'milk': 0.3, 'butter': 3.2, 'cream': 2.1,
      'egg': 1.1, 'pasta': 0.3, 'rice': 0.4, 'bread': 0.2,
      'potato': 0.1, 'vegetable': 0.1, 'fruit': 0.1, 'salad': 0.2,
      'quinoa': 0.2, 'tofu': 0.3, 'beans': 0.1, 'lentil': 0.1
    };
    
    let emissions = 0;
    Object.keys(dishDatabase).forEach(key => {
      if (dish.includes(key)) {
        emissions = Math.max(emissions, dishDatabase[key]);
      }
    });
    
    // Meal type multiplier
    const mealMultiplier = mealType === 'dinner' ? 1.2 : mealType === 'breakfast' ? 0.8 : 1.0;
    emissions *= mealMultiplier;
    
    document.getElementById('dishCarbon').textContent = emissions.toFixed(1);
  }

  function toggleCookingStyle() {
    const toggle = document.getElementById('cookingToggle');
    const impact = document.getElementById('cookingImpact');
    
    if (toggle.checked) {
      impact.textContent = 'Restaurant meals typically have 20% higher carbon footprint';
    } else {
      impact.textContent = 'Home-cooked meals typically have 20% lower carbon footprint';
    }
    updateFoodCalculation();
  }

  function toggleProduceSource() {
    const toggle = document.getElementById('produceToggle');
    const impact = document.getElementById('produceImpact');
    
    if (toggle.checked) {
      impact.textContent = 'Imported produce increases transport emissions by up to 30%';
    } else {
      impact.textContent = 'Local produce reduces transport emissions by up to 30%';
    }
    updateFoodCalculation();
  }

  // Energy tracking functions
  function switchEnergyTab(tabName) {
    // Remove active class from all buttons
    document.querySelectorAll('.energy-tab-btn').forEach(btn => {
      btn.classList.remove('active', 'bg-white', 'text-slate-800', 'shadow-sm');
      btn.classList.add('text-slate-600');
    });
    
    // Hide all tab contents
    document.querySelectorAll('.energy-tab-content').forEach(content => {
      content.classList.add('hidden');
      content.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabName === 'manual' ? 'manualEntry' : 'uploadBill').classList.remove('hidden');
    document.getElementById(tabName === 'manual' ? 'manualEntry' : 'uploadBill').classList.add('active');
    
    // Add active class to clicked button
    const activeBtn = document.getElementById(tabName === 'manual' ? 'manualTabBtn' : 'uploadTabBtn');
    activeBtn.classList.add('active', 'bg-white', 'text-slate-800', 'shadow-sm');
    activeBtn.classList.remove('text-slate-600');
  }

  function updateEnergySlider(type, value) {
    document.getElementById(type + 'Value').textContent = value;
    document.getElementById(type + 'Input').value = value;
    updateEnergyCalculation();
  }

  function updateEnergyFromInput(type, value) {
    if (value >= 0) {
      document.getElementById(type + 'Slider').value = value;
      document.getElementById(type + 'Value').textContent = value;
      updateEnergyCalculation();
    }
  }

  function updateEnergyCalculation() {
    // Get all energy input values
    const electricity = parseFloat(document.getElementById('electricitySlider').value) || 0;
    const electricitySource = document.getElementById('electricitySource').value;
    const heating = parseFloat(document.getElementById('heatingSlider').value) || 0;
    const heatingType = document.getElementById('heatingType').value;
    const gas = parseFloat(document.getElementById('gasSlider').value) || 0;
    const hasRenewable = document.getElementById('renewableToggle').checked;

    // Carbon emission factors
    const electricityFactors = {
      grid: 0.6,      // kg CO2 per kWh (mixed grid)
      coal: 0.9,      // kg CO2 per kWh
      gas: 0.4,       // kg CO2 per kWh
      renewable: 0.1, // kg CO2 per kWh
      solar: 0.05     // kg CO2 per kWh
    };

    const heatingFactors = {
      electric: 0.3,  // kg CO2 per hour
      gas: 0.2,       // kg CO2 per hour
      other: 0.25     // kg CO2 per hour
    };

    const gasEmissionFactor = 3.0; // kg CO2 per kg LPG

    // Calculate emissions
    let electricityEmissions = electricity * electricityFactors[electricitySource];
    const heatingEmissions = heating * heatingFactors[heatingType] * 30; // Monthly
    const gasEmissions = gas * gasEmissionFactor;

    // Apply renewable energy reduction
    if (hasRenewable) {
      electricityEmissions *= 0.2; // 80% reduction
    }

    const totalEmissions = electricityEmissions + heatingEmissions + gasEmissions;

    // Update individual CO2 displays
    animateValue('electricityCO2', electricityEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('heatingCO2', heatingEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('gasCO2', gasEmissions.toFixed(1) + ' kg CO‚ÇÇ');

    // Update category totals
    animateValue('electricityTotalEmissions', electricityEmissions.toFixed(1) + ' kg');
    animateValue('heatingTotalEmissions', heatingEmissions.toFixed(1) + ' kg');
    animateValue('gasTotalEmissions', gasEmissions.toFixed(1) + ' kg');

    // Update main displays
    animateValue('energyMonthlyEmissions', totalEmissions.toFixed(1));
    animateValue('energyGaugeValue', totalEmissions.toFixed(1));

    // Update progress gauge
    updateEnergyProgressGauge(totalEmissions);
    
    // Update progress bar
    const monthlyTarget = 350.0;
    const percentage = Math.min((totalEmissions / monthlyTarget) * 100, 100);
    document.getElementById('energyProgressPercentage').textContent = percentage.toFixed(0) + '%';
    document.getElementById('energyProgressBar').style.width = percentage + '%';

    // Update stacked bar chart
    updateEnergyStackedBar(electricityEmissions, heatingEmissions, gasEmissions);

    // Update tip
    updateEnergyTip(electricitySource, hasRenewable, totalEmissions);
  }

  function updateEnergyProgressGauge(value) {
    const maxValue = 500; // Max expected monthly energy emissions
    const percentage = Math.min(value / maxValue, 1);
    const circumference = 251.2; // 2 * œÄ * 40
    const offset = circumference - (percentage * circumference);
    
    const circle = document.getElementById('energyProgressCircle');
    if (circle) {
      circle.style.strokeDashoffset = offset;
    }
  }

  function updateEnergyStackedBar(electricity, heating, gas) {
    const total = electricity + heating + gas || 1;
    const electricityPercent = (electricity / total) * 100;
    const heatingPercent = (heating / total) * 100;
    const gasPercent = (gas / total) * 100;

    document.getElementById('electricityBar').style.width = electricityPercent + '%';
    document.getElementById('heatingBar').style.width = heatingPercent + '%';
    document.getElementById('gasBar').style.width = gasPercent + '%';
  }

  function updateEnergyTip(source, hasRenewable, totalEmissions) {
    const tipElement = document.getElementById('energyTip');
    if (!tipElement) return;
    
    if (source === 'coal' && !hasRenewable) {
      tipElement.textContent = 'Switching to renewable energy could reduce your emissions by up to 80%!';
    } else if (!hasRenewable && totalEmissions > 300) {
      const savings = (totalEmissions * 0.6).toFixed(0);
      tipElement.textContent = `Installing solar panels could save you ${savings} kg CO‚ÇÇ per month!`;
    } else if (hasRenewable) {
      tipElement.textContent = 'Great job using renewable energy! Your carbon footprint is significantly reduced.';
    } else if (totalEmissions < 200) {
      tipElement.textContent = 'Excellent! Your energy usage has a low carbon footprint.';
    } else {
      tipElement.textContent = 'Consider upgrading to energy-efficient appliances to reduce your footprint.';
    }
  }

  function toggleRenewable() {
    const toggle = document.getElementById('renewableToggle');
    const impact = document.getElementById('renewableImpact');
    
    if (toggle.checked) {
      impact.textContent = 'Renewable energy is reducing your carbon footprint by up to 80%!';
    } else {
      impact.textContent = 'Renewable energy can reduce your carbon footprint by up to 80%';
    }
    updateEnergyCalculation();
  }

  function handleEnergyFiles(files) {
    const progressDiv = document.getElementById('energyUploadProgress');
    const filesDiv = document.getElementById('energyUploadedFiles');
    const extractedDiv = document.getElementById('energyExtractedData');
    const progressBar = document.getElementById('energyProgressBar');
    const progressText = document.getElementById('energyProgressText');
    
    if (files.length === 0) return;
    
    // Show progress
    progressDiv.classList.remove('hidden');
    
    // Simulate AI processing
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 15;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        
        // Show extracted data after processing
        setTimeout(() => {
          progressDiv.classList.add('hidden');
          filesDiv.classList.remove('hidden');
          extractedDiv.classList.remove('hidden');
          
          // Simulate extracted values
          document.getElementById('extractedElectricity').value = 285;
          document.getElementById('extractedGas').value = 18;
          document.getElementById('extractedPeriod').value = 'March 2024';
          
          // Update calculations with extracted data
          updateFromExtracted();
        }, 500);
      }
      
      progressBar.style.width = progress + '%';
      progressText.textContent = Math.round(progress) + '%';
    }, 200);
  }

  function updateFromExtracted() {
    const electricity = parseFloat(document.getElementById('extractedElectricity').value) || 0;
    const gas = parseFloat(document.getElementById('extractedGas').value) || 0;
    
    // Update manual inputs
    document.getElementById('electricitySlider').value = electricity;
    document.getElementById('electricityInput').value = electricity;
    document.getElementById('electricityValue').textContent = electricity;
    
    document.getElementById('gasSlider').value = gas;
    document.getElementById('gasInput').value = gas;
    document.getElementById('gasValue').textContent = gas;
    
    updateEnergyCalculation();
  }

  // Shopping tracking functions
  function updateShoppingSlider(type, value) {
    document.getElementById(type + 'Value').textContent = value;
    document.getElementById(type + 'Input').value = value;
    updateShoppingCalculation();
  }

  function updateShoppingFromInput(type, value) {
    if (value >= 0) {
      document.getElementById(type + 'Slider').value = value;
      document.getElementById(type + 'Value').textContent = value;
      updateShoppingCalculation();
    }
  }

  function updateShoppingCalculation() {
    // Get all shopping input values
    const clothing = parseFloat(document.getElementById('clothingSlider').value) || 0;
    const clothingType = document.getElementById('clothingType').value;
    const electronics = parseFloat(document.getElementById('electronicsSlider').value) || 0;
    const electronicsType = document.getElementById('electronicsType').value;
    const appliances = parseFloat(document.getElementById('appliancesSlider').value) || 0;
    const appliancesType = document.getElementById('appliancesType').value;
    const deliveries = parseFloat(document.getElementById('deliveriesSlider').value) || 0;
    const hasEcoDelivery = document.getElementById('ecoDeliveryToggle').checked;

    // Carbon emission factors
    const clothingFactors = {
      fast: 8.0,        // kg CO2 per item (fast fashion)
      sustainable: 4.0, // kg CO2 per item (sustainable)
      secondhand: 1.6   // kg CO2 per item (second-hand)
    };

    const electronicsFactors = {
      phone: 70,    // kg CO2 per device per year
      laptop: 300,  // kg CO2 per device per year
      tv: 500,      // kg CO2 per device per year
      other: 100    // kg CO2 per device per year
    };

    const appliancesFactors = {
      fridge: 0.15,    // kg CO2 per hour
      washing: 0.2,    // kg CO2 per hour
      ac: 0.3,         // kg CO2 per hour
      other: 0.18      // kg CO2 per hour
    };

    const deliveryEmissionFactor = 2.0; // kg CO2 per package

    // Calculate emissions
    const clothingEmissions = clothing * clothingFactors[clothingType];
    const electronicsEmissions = (electronics * electronicsFactors[electronicsType]) / 12; // Monthly
    const appliancesEmissions = appliances * appliancesFactors[appliancesType] * 30; // Monthly
    let deliveriesEmissions = deliveries * deliveryEmissionFactor;

    // Apply eco-delivery reduction
    if (hasEcoDelivery) {
      deliveriesEmissions *= 0.7; // 30% reduction for eco-friendly delivery
    }

    const totalEmissions = clothingEmissions + electronicsEmissions + appliancesEmissions + deliveriesEmissions;

    // Update individual CO2 displays
    animateValue('clothingCO2', clothingEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('electronicsCO2', electronicsEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('appliancesCO2', appliancesEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    animateValue('deliveriesCO2', deliveriesEmissions.toFixed(1) + ' kg CO‚ÇÇ');

    // Update category totals
    animateValue('clothingTotalEmissions', clothingEmissions.toFixed(1) + ' kg');
    animateValue('electronicsTotalEmissions', electronicsEmissions.toFixed(1) + ' kg');
    animateValue('appliancesTotalEmissions', appliancesEmissions.toFixed(1) + ' kg');
    animateValue('deliveriesTotalEmissions', deliveriesEmissions.toFixed(1) + ' kg');

    // Update main displays
    animateValue('shoppingMonthlyEmissions', totalEmissions.toFixed(1));
    animateValue('shoppingGaugeValue', totalEmissions.toFixed(1));

    // Update progress gauge
    updateShoppingProgressGauge(totalEmissions);
    
    // Update progress bar
    const monthlyTarget = 200.0;
    const percentage = Math.min((totalEmissions / monthlyTarget) * 100, 100);
    document.getElementById('shoppingProgressPercentage').textContent = percentage.toFixed(0) + '%';
    document.getElementById('shoppingProgressBar').style.width = percentage + '%';

    // Update pie chart
    updateShoppingPieChart(clothingEmissions, electronicsEmissions, appliancesEmissions, deliveriesEmissions);

    // Update hotspots
    updateShoppingHotspots(clothingEmissions, electronicsEmissions, appliancesEmissions, deliveriesEmissions);

    // Update tip
    updateShoppingTip(clothingType, hasEcoDelivery, electronicsEmissions, totalEmissions);
  }

  function updateShoppingProgressGauge(value) {
    const maxValue = 300; // Max expected monthly shopping emissions
    const percentage = Math.min(value / maxValue, 1);
    const circumference = 251.2; // 2 * œÄ * 40
    const offset = circumference - (percentage * circumference);
    
    const circle = document.getElementById('shoppingProgressCircle');
    if (circle) {
      circle.style.strokeDashoffset = offset;
    }
  }

  function updateShoppingPieChart(clothing, electronics, appliances, deliveries) {
    const total = clothing + electronics + appliances + deliveries || 1;
    const clothingPercent = (clothing / total) * 100;
    const electronicsPercent = (electronics / total) * 100;
    const appliancesPercent = (appliances / total) * 100;
    const deliveriesPercent = (deliveries / total) * 100;

    // Update pie chart slices
    document.getElementById('electronicsSlice').style.strokeDasharray = `${electronicsPercent} ${100 - electronicsPercent}`;
    document.getElementById('appliancesSlice').style.strokeDasharray = `${appliancesPercent} ${100 - appliancesPercent}`;
    document.getElementById('appliancesSlice').style.strokeDashoffset = `-${electronicsPercent}`;
    document.getElementById('clothingSlice').style.strokeDasharray = `${clothingPercent} ${100 - clothingPercent}`;
    document.getElementById('clothingSlice').style.strokeDashoffset = `-${electronicsPercent + appliancesPercent}`;
    document.getElementById('deliveriesSlice').style.strokeDasharray = `${deliveriesPercent} ${100 - deliveriesPercent}`;
    document.getElementById('deliveriesSlice').style.strokeDashoffset = `-${electronicsPercent + appliancesPercent + clothingPercent}`;
  }

  function updateShoppingHotspots(clothing, electronics, appliances, deliveries) {
    const categories = [
      { name: 'Electronics', value: electronics },
      { name: 'Appliances', value: appliances },
      { name: 'Clothing', value: clothing },
      { name: 'Deliveries', value: deliveries }
    ];
    
    // Sort by emissions (highest first)
    categories.sort((a, b) => b.value - a.value);
    
    const total = clothing + electronics + appliances + deliveries || 1;
    const topPercent = ((categories[0].value / total) * 100).toFixed(0);
    const secondPercent = ((categories[1].value / total) * 100).toFixed(0);
    
    document.getElementById('topContributor').textContent = `${categories[0].name} (${topPercent}%)`;
    document.getElementById('secondContributor').textContent = `${categories[1].name} (${secondPercent}%)`;
  }

  function updateShoppingTip(clothingType, hasEcoDelivery, electronicsEmissions, totalEmissions) {
    const tipElement = document.getElementById('shoppingTip');
    if (!tipElement) return;
    
    if (clothingType === 'fast' && electronicsEmissions > 50) {
      tipElement.textContent = 'Choosing second-hand clothing and extending device lifespan could significantly reduce your footprint!';
    } else if (clothingType === 'fast') {
      tipElement.textContent = 'Switching to second-hand or sustainable fashion could reduce your clothing footprint by up to 80%!';
    } else if (!hasEcoDelivery && totalEmissions > 150) {
      tipElement.textContent = 'Choosing eco-friendly delivery options could reduce your shipping emissions by 30%!';
    } else if (electronicsEmissions > 80) {
      tipElement.textContent = 'Consider extending the lifespan of your electronics to reduce replacement emissions.';
    } else if (totalEmissions < 100) {
      tipElement.textContent = 'Excellent! Your consumption habits have a relatively low carbon footprint.';
    } else {
      tipElement.textContent = 'Consider buying less frequently and choosing sustainable options when possible.';
    }
  }

  function toggleEcoDelivery() {
    updateShoppingCalculation();
  }

  function handleShoppingFiles(files) {
    const progressDiv = document.getElementById('shoppingUploadProgress');
    const extractedDiv = document.getElementById('shoppingExtractedData');
    const progressBar = document.getElementById('shoppingProgressBar');
    const progressText = document.getElementById('shoppingProgressText');
    
    if (files.length === 0) return;
    
    // Show progress
    progressDiv.classList.remove('hidden');
    
    // Simulate AI processing
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 12;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        
        // Show extracted data after processing
        setTimeout(() => {
          progressDiv.classList.add('hidden');
          extractedDiv.classList.remove('hidden');
          
          // Simulate extracted values
          document.getElementById('extractedClothing').value = 2;
          document.getElementById('extractedElectronics').value = 1;
          document.getElementById('extractedHousehold').value = 3;
          document.getElementById('extractedAmount').value = '$245.67';
          
          // Update calculations with extracted data
          updateFromShoppingExtracted();
        }, 500);
      }
      
      progressBar.style.width = progress + '%';
      progressText.textContent = Math.round(progress) + '%';
    }, 250);
  }

  function updateFromShoppingExtracted() {
    const clothing = parseFloat(document.getElementById('extractedClothing').value) || 0;
    const electronics = parseFloat(document.getElementById('extractedElectronics').value) || 0;
    const household = parseFloat(document.getElementById('extractedHousehold').value) || 0;
    
    // Update manual inputs
    document.getElementById('clothingSlider').value = clothing;
    document.getElementById('clothingInput').value = clothing;
    document.getElementById('clothingValue').textContent = clothing;
    
    document.getElementById('electronicsSlider').value = electronics;
    document.getElementById('electronicsInput').value = electronics;
    document.getElementById('electronicsValue').textContent = electronics;
    
    document.getElementById('appliancesSlider').value = household;
    document.getElementById('appliancesInput').value = household;
    document.getElementById('appliancesValue').textContent = household;
    
    updateShoppingCalculation();
  }

  // Waste tracking functions
  function updateWasteSlider(type, value) {
    document.getElementById(type + 'Value').textContent = parseFloat(value).toFixed(1);
    document.getElementById(type + 'Input').value = value;
    updateWasteCalculation();
  }

  function updateWasteFromInput(type, value) {
    if (value >= 0) {
      document.getElementById(type + 'Slider').value = value;
      document.getElementById(type + 'Value').textContent = parseFloat(value).toFixed(1);
      updateWasteCalculation();
    }
  }

  function togglePaperRecycling() {
    const toggle = document.getElementById('paperToggle');
    const input = document.getElementById('paperRecyclingInput');
    
    if (toggle.checked) {
      input.classList.remove('hidden');
    } else {
      input.classList.add('hidden');
    }
    updateWasteCalculation();
  }

  function toggleGlassRecycling() {
    const toggle = document.getElementById('glassToggle');
    const input = document.getElementById('glassRecyclingInput');
    
    if (toggle.checked) {
      input.classList.remove('hidden');
    } else {
      input.classList.add('hidden');
    }
    updateWasteCalculation();
  }

  function toggleComposting() {
    const toggle = document.getElementById('compostToggle');
    const input = document.getElementById('compostInput');
    
    if (toggle.checked) {
      input.classList.remove('hidden');
    } else {
      input.classList.add('hidden');
    }
    updateWasteCalculation();
  }

  function updateWasteCalculation() {
    // Get all waste input values
    const plastic = parseFloat(document.getElementById('plasticSlider').value) || 0;
    const paperRecycling = document.getElementById('paperToggle').checked;
    const paper = paperRecycling ? (parseFloat(document.getElementById('paperSlider').value) || 0) : 0;
    const glassRecycling = document.getElementById('glassToggle').checked;
    const glass = glassRecycling ? (parseFloat(document.getElementById('glassSlider').value) || 0) : 0;
    const composting = document.getElementById('compostToggle').checked;
    const compost = composting ? (parseFloat(document.getElementById('compostSlider').value) || 0) : 0;

    // Carbon emission/saving factors (kg CO2 per kg)
    const wasteFactors = {
      plastic: 6.0,    // kg CO2 per kg plastic waste (positive impact)
      paper: -3.0,     // kg CO2 saved per kg paper recycled (negative impact)
      glass: -4.0,     // kg CO2 saved per kg glass/metal recycled
      compost: -2.0    // kg CO2 saved per kg composted (methane reduction)
    };

    // Calculate emissions (positive = bad, negative = good)
    const plasticEmissions = plastic * wasteFactors.plastic;
    const paperSavings = paper * wasteFactors.paper;
    const glassSavings = glass * wasteFactors.glass;
    const compostSavings = compost * wasteFactors.compost;

    const totalEmissions = plasticEmissions + paperSavings + glassSavings + compostSavings;

    // Update individual CO2 displays
    animateValue('plasticCO2', plasticEmissions.toFixed(1) + ' kg CO‚ÇÇ');
    if (paperRecycling) {
      animateValue('paperCO2', paperSavings.toFixed(1) + ' kg CO‚ÇÇ');
    }
    if (glassRecycling) {
      animateValue('glassCO2', glassSavings.toFixed(1) + ' kg CO‚ÇÇ');
    }
    if (composting) {
      animateValue('compostCO2', compostSavings.toFixed(1) + ' kg CO‚ÇÇ');
    }

    // Update category totals
    animateValue('plasticTotalEmissions', (plasticEmissions >= 0 ? '+' : '') + plasticEmissions.toFixed(1) + ' kg');
    animateValue('paperTotalEmissions', (paperSavings >= 0 ? '+' : '') + paperSavings.toFixed(1) + ' kg');
    animateValue('glassTotalEmissions', (glassSavings >= 0 ? '+' : '') + glassSavings.toFixed(1) + ' kg');
    animateValue('compostTotalEmissions', (compostSavings >= 0 ? '+' : '') + compostSavings.toFixed(1) + ' kg');

    // Update main displays
    animateValue('wasteWeeklyEmissions', (totalEmissions >= 0 ? '+' : '') + totalEmissions.toFixed(1));
    animateValue('wasteGaugeValue', (totalEmissions >= 0 ? '+' : '') + totalEmissions.toFixed(1));

    // Update progress gauge
    updateWasteProgressGauge(totalEmissions);
    
    // Update progress bar (negative is better for waste)
    const weeklyTarget = -10.0; // Target is negative (savings)
    const percentage = totalEmissions <= weeklyTarget ? 100 : Math.max(0, (Math.abs(totalEmissions) / Math.abs(weeklyTarget)) * 100);
    document.getElementById('wasteProgressPercentage').textContent = Math.min(percentage, 100).toFixed(0) + '%';
    document.getElementById('wasteProgressBar').style.width = Math.min(percentage, 100) + '%';

    // Update stacked bar chart
    updateWasteStackedBar(plasticEmissions, Math.abs(paperSavings + glassSavings + compostSavings));

    // Update hotspots
    updateWasteHotspots(plasticEmissions, paperSavings, glassSavings, compostSavings);

    // Update tip
    updateWasteTip(plastic, paperRecycling, glassRecycling, composting, totalEmissions);
  }

  function updateWasteProgressGauge(value) {
    // For waste, negative values are good (savings), positive are bad
    const maxValue = 20; // Max expected weekly waste emissions
    const minValue = -20; // Max expected weekly savings
    
    let percentage;
    if (value >= 0) {
      // Positive emissions (bad)
      percentage = Math.min(value / maxValue, 1);
    } else {
      // Negative emissions (good savings)
      percentage = Math.min(Math.abs(value) / Math.abs(minValue), 1);
    }
    
    const circumference = 251.2; // 2 * œÄ * 40
    const offset = circumference - (percentage * circumference);
    
    const circle = document.getElementById('wasteProgressCircle');
    if (circle) {
      circle.style.strokeDashoffset = offset;
      // Change color based on positive/negative
      if (value >= 0) {
        circle.style.stroke = '#dc2626'; // Red for positive emissions
      } else {
        circle.style.stroke = 'url(#wasteGradient)'; // Green for savings
      }
    }
  }

  function updateWasteStackedBar(plastic, recycling) {
    const total = plastic + recycling || 1;
    const plasticPercent = (plastic / total) * 100;
    const recyclingPercent = (recycling / total) * 100;

    document.getElementById('plasticWasteBar').style.width = plasticPercent + '%';
    document.getElementById('recyclingBar').style.width = recyclingPercent + '%';
  }

  function updateWasteHotspots(plastic, paper, glass, compost) {
    // Find largest positive impact (waste generation)
    const topContributor = plastic > 0 ? `Plastic Waste (+${plastic.toFixed(1)} kg)` : 'No waste generated';
    
    // Find best saver (most negative impact)
    const savers = [
      { name: 'Paper Recycling', value: paper },
      { name: 'Glass/Metal', value: glass },
      { name: 'Composting', value: compost }
    ];
    
    savers.sort((a, b) => a.value - b.value); // Sort by most negative first
    const bestSaver = savers[0].value < 0 ? 
      `${savers[0].name} (${savers[0].value.toFixed(1)} kg)` : 
      'No recycling activities';
    
    document.getElementById('wasteTopContributor').textContent = topContributor;
    document.getElementById('wasteBestSaver').textContent = bestSaver;
  }

  function updateWasteTip(plastic, paperRecycling, glassRecycling, composting, totalEmissions) {
    const tipElement = document.getElementById('wasteTip');
    if (!tipElement) return;
    
    if (plastic > 3 && !paperRecycling && !glassRecycling) {
      tipElement.textContent = 'Start recycling paper and glass to offset your plastic waste impact!';
    } else if (plastic > 5) {
      tipElement.textContent = 'Consider reducing plastic consumption - bring reusable bags and containers!';
    } else if (!composting && totalEmissions > -5) {
      tipElement.textContent = 'Starting a compost bin could save 2kg CO‚ÇÇ per kg of organic waste!';
    } else if (totalEmissions < -15) {
      tipElement.textContent = 'Outstanding! Your waste habits are making a significant positive impact.';
    } else if (paperRecycling && glassRecycling && composting) {
      tipElement.textContent = 'Excellent recycling habits! Consider reducing overall consumption for even better impact.';
    } else {
      tipElement.textContent = 'Great job recycling! Reducing plastic use could further improve your waste footprint.';
    }
  }

  function handleWasteFiles(files) {
    const progressDiv = document.getElementById('wasteUploadProgress');
    const extractedDiv = document.getElementById('wasteExtractedData');
    const progressBar = document.getElementById('wasteProgressBar');
    const progressText = document.getElementById('wasteProgressText');
    
    if (files.length === 0) return;
    
    // Show progress
    progressDiv.classList.remove('hidden');
    
    // Simulate AI processing
    let progress = 0;
    const interval = setInterval(() => {
      progress += Math.random() * 10;
      if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        
        // Show extracted data after processing
        setTimeout(() => {
          progressDiv.classList.add('hidden');
          extractedDiv.classList.remove('hidden');
          
          // Simulate extracted values
          document.getElementById('extractedPlastic').value = 1.8;
          document.getElementById('extractedPaper').value = 4.2;
          document.getElementById('extractedGlass').value = 2.1;
          document.getElementById('extractedCompost').value = 3.5;
          
          // Update calculations with extracted data
          updateFromWasteExtracted();
        }, 500);
      }
      
      progressBar.style.width = progress + '%';
      progressText.textContent = Math.round(progress) + '%';
    }, 300);
  }

  function updateFromWasteExtracted() {
    const plastic = parseFloat(document.getElementById('extractedPlastic').value) || 0;
    const paper = parseFloat(document.getElementById('extractedPaper').value) || 0;
    const glass = parseFloat(document.getElementById('extractedGlass').value) || 0;
    const compost = parseFloat(document.getElementById('extractedCompost').value) || 0;
    
    // Update manual inputs
    document.getElementById('plasticSlider').value = plastic;
    document.getElementById('plasticInput').value = plastic;
    document.getElementById('plasticValue').textContent = plastic.toFixed(1);
    
    if (paper > 0) {
      document.getElementById('paperToggle').checked = true;
      document.getElementById('paperRecyclingInput').classList.remove('hidden');
      document.getElementById('paperSlider').value = paper;
      document.getElementById('paperInput').value = paper;
      document.getElementById('paperValue').textContent = paper.toFixed(1);
    }
    
    if (glass > 0) {
      document.getElementById('glassToggle').checked = true;
      document.getElementById('glassRecyclingInput').classList.remove('hidden');
      document.getElementById('glassSlider').value = glass;
      document.getElementById('glassInput').value = glass;
      document.getElementById('glassValue').textContent = glass.toFixed(1);
    }
    
    if (compost > 0) {
      document.getElementById('compostToggle').checked = true;
      document.getElementById('compostInput').classList.remove('hidden');
      document.getElementById('compostSlider').value = compost;
      document.getElementById('compostInputField').value = compost;
      document.getElementById('compostValue').textContent = compost.toFixed(1);
    }
    
    updateWasteCalculation();
  }

  // Update slider values
  function updateValue(type, value) {
    document.getElementById(type + 'Value').textContent = value + ' km';
    updateCalculation();
  }

  // Real-time calculation
  function updateCalculation() {
    const travel = parseInt(document.getElementById('travelSlider').value) || 0;
    const meat = parseInt(document.getElementById('meatMeals').value) || 0;
    const electricity = parseInt(document.getElementById('electricity').value) || 0;
    const shopping = document.getElementById('shopping').value;
    
    // Simple calculation (replace with actual API call)
    const travelEmissions = travel * 0.17; // kg CO2 per km
    const foodEmissions = meat * 0.83; // kg CO2 per meal per week / 7
    const energyEmissions = electricity * 0.007; // kg CO2 per kWh / 30 days
    const shoppingMultiplier = shopping === 'low' ? 0.5 : shopping === 'high' ? 2 : 1;
    const shoppingEmissions = 0.4 * shoppingMultiplier;
    
    const total = travelEmissions + foodEmissions + energyEmissions + shoppingEmissions;
    
    // Update display
    document.getElementById('totalEmissions').textContent = total.toFixed(1);
    document.getElementById('travelEmissions').textContent = travelEmissions.toFixed(1);
    document.getElementById('foodEmissions').textContent = foodEmissions.toFixed(1);
    document.getElementById('energyEmissions').textContent = energyEmissions.toFixed(1);
    document.getElementById('shoppingEmissions').textContent = shoppingEmissions.toFixed(1);
    
    // Update hotspot
    const categories = [
      { name: 'Travel', value: travelEmissions },
      { name: 'Food', value: foodEmissions },
      { name: 'Energy', value: energyEmissions },
      { name: 'Shopping', value: shoppingEmissions }
    ];
    
    const hotspot = categories.reduce((max, cat) => cat.value > max.value ? cat : max);
    document.getElementById('hotspot').textContent = `${hotspot.name} is your highest emission source`;
  }

  // File upload handling
  function handleFiles(files) {
    const preview = document.getElementById('filePreview');
    const results = document.getElementById('aiResults');
    
    preview.style.display = 'grid';
    preview.innerHTML = '';
    
    Array.from(files).forEach(file => {
      const div = document.createElement('div');
      div.className = 'bg-gray-100 rounded-lg p-4 text-center';
      div.innerHTML = `
        <i class="fas fa-file-image text-2xl text-blue-500 mb-2"></i>
        <div class="text-sm font-medium truncate">${file.name}</div>
        <div class="text-xs text-gray-500">${(file.size / 1024).toFixed(1)} KB</div>
      `;
      preview.appendChild(div);
    });
    
    // Simulate AI processing
    setTimeout(() => {
      results.style.display = 'block';
    }, 2000);
  }

  // Drag and drop functionality
  const dropArea = document.getElementById('dropArea');
  
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
  });
  
  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }
  
  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.add('dragover'), false);
  });
  
  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragover'), false);
  });
  
  dropArea.addEventListener('drop', (e) => {
    const files = e.dataTransfer.files;
    handleFiles(files);
  });

  // Food carbon calculator
  function calculateFoodCarbon() {
    const food = document.getElementById('foodInput').value.toLowerCase();
    const portion = document.getElementById('portionSize').value;
    
    // Simple food carbon database (replace with actual API)
    const foodDatabase = {
      'beef': 6.8,
      'burger': 5.2,
      'chicken': 2.1,
      'fish': 1.8,
      'pork': 3.4,
      'lamb': 7.2,
      'cheese': 2.8,
      'milk': 0.9,
      'egg': 1.1,
      'rice': 0.4,
      'pasta': 0.3,
      'bread': 0.2,
      'vegetable': 0.1,
      'fruit': 0.1,
      'quinoa': 0.2,
      'tofu': 0.3
    };
    
    let emissions = 0;
    Object.keys(foodDatabase).forEach(key => {
      if (food.includes(key)) {
        emissions = Math.max(emissions, foodDatabase[key]);
      }
    });
    
    // Adjust for portion size
    const portionMultiplier = portion === 'small' ? 0.7 : portion === 'large' ? 1.5 : 1;
    emissions *= portionMultiplier;
    
    document.getElementById('foodCarbonResult').textContent = emissions.toFixed(1);
  }

  // Save to dashboard
  function saveToDashboard() {
    // Simulate saving data
    alert('Data saved! Redirecting to dashboard...');
    // In real implementation, this would save to backend and redirect
    // window.location.href = '/dashboard/';
  }

  // Initialize calculations
  updateCalculation();
  updateFoodCalculation();
  updateTransportCalculation();
  updateEnergyCalculation();
  updateShoppingCalculation();
  updateWasteCalculation();
</script>

{% endblock %}
