{% extends "layout.html" %}

{% block title %}Track Your Carbon Footprint | Carbon Tracker{% endblock %}

{% block content %}
<!-- CDN Scripts -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
  :root {
    --primary-green: #27ae60;
    --primary-blue: #3498db;
    --dark-green: #229954;
    --light-green: #58d68d;
  }
  
  .gradient-text {
    background: linear-gradient(135deg, var(--primary-green), var(--primary-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .tab-button {
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    cursor: pointer;
  }
  
  .tab-button.active {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
  }
  
  .tab-button:not(.active) {
    background: white;
    color: #64748b;
    border-color: #e2e8f0;
  }
  
  .tab-button:not(.active):hover {
    border-color: var(--primary-green);
    color: var(--primary-green);
  }
  
  .form-input, .form-select {
    width: 100%;
    padding: 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
  }
  
  .form-input:focus, .form-select:focus {
    outline: none;
    border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
  }
  
  .slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: #e2e8f0;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
  }
  
  .slider::-webkit-slider-thumb {
    appearance: none;
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--primary-green);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
  }
  
  .progress-gauge {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: conic-gradient(var(--primary-green) 0deg 252deg, #e5e7eb 252deg 360deg);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin: 0 auto;
  }
  
  .progress-gauge::before {
    content: '';
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: white;
    position: absolute;
  }
  
  .drag-drop-area {
    border: 3px dashed #cbd5e1;
    border-radius: 16px;
    padding: 3rem;
    text-align: center;
    transition: all 0.3s ease;
    background: #f8fafc;
    cursor: pointer;
  }
  
  .drag-drop-area.dragover {
    border-color: var(--primary-green);
    background: rgba(39, 174, 96, 0.05);
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
    color: white;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
  }
  
  .category-card {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }
  
  .category-card:hover {
    border-color: var(--primary-green);
    transform: translateY(-2px);
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
</style>

<!-- Header Section -->
<section class="py-16 px-6 bg-gradient-to-br from-green-50 to-blue-50">
  <div class="max-w-4xl mx-auto text-center">
    <h1 class="text-5xl md:text-6xl font-black mb-6" data-aos="fade-up">
      <span class="gradient-text">Track Your Carbon Footprint</span>
    </h1>
    <p class="text-xl text-slate-600 max-w-2xl mx-auto leading-relaxed" data-aos="fade-up" data-aos-delay="100">
      Log your daily activities and let AI calculate your carbon impact. Choose your preferred tracking method below.
    </p>
  </div>
</section>

<!-- Data Collection Methods -->
<section class="py-16 px-6 bg-white">
  <div class="max-w-6xl mx-auto">
    <!-- Tab Navigation -->
    <div class="flex flex-wrap justify-center gap-4 mb-12" data-aos="fade-up">
      <button class="tab-button active" onclick="switchTab('questionnaire')">
        <i class="fas fa-clipboard-list mr-2"></i>
        Lifestyle Questionnaire
      </button>
      <button class="tab-button" onclick="switchTab('scanner')">
        <i class="fas fa-camera mr-2"></i>
        Receipt Scanner
      </button>
      <button class="tab-button" onclick="switchTab('calculator')">
        <i class="fas fa-utensils mr-2"></i>
        Food Calculator
      </button>
    </div>

    <!-- Questionnaire Tab -->
    <div id="questionnaire" class="tab-content active">
      <div class="grid lg:grid-cols-2 gap-12 items-start">
        <!-- Interactive Form -->
        <div class="space-y-8" data-aos="fade-right">
          <div class="bg-white rounded-3xl p-8 shadow-lg border border-green-100">
            <h3 class="text-2xl font-bold text-slate-800 mb-6">Daily Lifestyle Questions</h3>
            
            <!-- Travel Distance -->
            <div class="mb-8">
              <label class="block text-lg font-semibold text-slate-700 mb-4">
                <i class="fas fa-car text-blue-500 mr-2"></i>
                How many kilometers do you travel daily?
              </label>
              <div class="slider-container">
                <input type="range" min="0" max="200" value="25" class="slider" id="travelSlider" oninput="updateValue('travel', this.value)">
                <div class="flex justify-between text-sm text-slate-500 mt-2">
                  <span>0 km</span>
                  <span class="font-semibold text-green-600" id="travelValue">25 km</span>
                  <span>200 km</span>
                </div>
              </div>
            </div>

            <!-- Meat Meals -->
            <div class="mb-8">
              <label class="block text-lg font-semibold text-slate-700 mb-4">
                <i class="fas fa-drumstick-bite text-red-500 mr-2"></i>
                How many meat-based meals per week?
              </label>
              <select class="form-select" id="meatMeals" onchange="updateCalculation()">
                <option value="0">0 meals (Vegan)</option>
                <option value="3">1-3 meals</option>
                <option value="7" selected>4-7 meals</option>
                <option value="14">8-14 meals</option>
                <option value="21">15+ meals</option>
              </select>
            </div>

            <!-- Electricity -->
            <div class="mb-8">
              <label class="block text-lg font-semibold text-slate-700 mb-4">
                <i class="fas fa-plug text-yellow-500 mr-2"></i>
                Electricity consumption (kWh/month)
              </label>
              <input type="number" placeholder="Enter kWh" class="form-input" id="electricity" value="300" oninput="updateCalculation()">
            </div>

            <!-- Shopping Frequency -->
            <div class="mb-8">
              <label class="block text-lg font-semibold text-slate-700 mb-4">
                <i class="fas fa-shopping-cart text-purple-500 mr-2"></i>
                Shopping frequency
              </label>
              <select class="form-select" id="shopping" onchange="updateCalculation()">
                <option value="low">Minimal (essentials only)</option>
                <option value="medium" selected>Moderate (weekly shopping)</option>
                <option value="high">Frequent (multiple times/week)</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Real-time Results -->
        <div class="sticky top-8" data-aos="fade-left">
          <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-3xl p-8 shadow-xl">
            <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">Your Carbon Impact</h3>
            
            <!-- Progress Gauge -->
            <div class="mb-8">
              <div class="progress-gauge">
                <div class="relative z-10 text-center">
                  <div class="text-4xl font-black text-green-600" id="totalEmissions">12.5</div>
                  <div class="text-sm text-slate-600 font-medium">kg CO‚ÇÇ/day</div>
                </div>
              </div>
            </div>

            <!-- Category Breakdown -->
            <div class="grid grid-cols-2 gap-4 mb-8">
              <div class="category-card">
                <i class="fas fa-car text-2xl text-blue-500 mb-2"></i>
                <div class="text-lg font-bold text-slate-800" id="travelEmissions">4.2</div>
                <div class="text-sm text-slate-500">Travel</div>
              </div>
              <div class="category-card">
                <i class="fas fa-utensils text-2xl text-red-500 mb-2"></i>
                <div class="text-lg font-bold text-slate-800" id="foodEmissions">5.8</div>
                <div class="text-sm text-slate-500">Food</div>
              </div>
              <div class="category-card">
                <i class="fas fa-plug text-2xl text-yellow-500 mb-2"></i>
                <div class="text-lg font-bold text-slate-800" id="energyEmissions">2.1</div>
                <div class="text-sm text-slate-500">Energy</div>
              </div>
              <div class="category-card">
                <i class="fas fa-shopping-bag text-2xl text-purple-500 mb-2"></i>
                <div class="text-lg font-bold text-slate-800" id="shoppingEmissions">0.4</div>
                <div class="text-sm text-slate-500">Shopping</div>
              </div>
            </div>

            <!-- Carbon Hotspots -->
            <div class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6">
              <h4 class="font-bold text-red-700 mb-2">üî• Carbon Hotspot</h4>
              <p class="text-sm text-red-600" id="hotspot">Food consumption is your highest emission source</p>
            </div>

            <!-- CTA Button -->
            <button class="btn-primary w-full text-lg" onclick="saveToDashboard()">
              <i class="fas fa-save"></i>
              Save & View Dashboard ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Receipt Scanner Tab -->
    <div id="scanner" class="tab-content">
      <div class="max-w-4xl mx-auto" data-aos="fade-up">
        <div class="bg-white rounded-3xl p-8 shadow-lg border border-blue-100">
          <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">
            <i class="fas fa-camera text-blue-500 mr-2"></i>
            Upload Your Receipts
          </h3>
          
          <!-- Drag & Drop Area -->
          <div class="drag-drop-area" id="dropArea" onclick="document.getElementById('fileInput').click()">
            <div class="mb-4">
              <i class="fas fa-cloud-upload-alt text-6xl text-slate-400"></i>
            </div>
            <h4 class="text-xl font-semibold text-slate-700 mb-2">Drop receipts here or click to upload</h4>
            <p class="text-slate-500 mb-4">Supports JPG, PNG, PDF files up to 10MB</p>
            <div class="inline-flex items-center px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
              <i class="fas fa-plus mr-2"></i>
              Choose Files
            </div>
          </div>
          
          <input type="file" id="fileInput" multiple accept="image/*,.pdf" style="display: none;" onchange="handleFiles(this.files)">
          
          <!-- File Preview -->
          <div id="filePreview" class="mt-8 grid grid-cols-2 md:grid-cols-3 gap-4" style="display: none;">
            <!-- Files will be displayed here -->
          </div>
          
          <!-- AI Processing Results -->
          <div id="aiResults" class="mt-8 bg-green-50 border border-green-200 rounded-xl p-6" style="display: none;">
            <h4 class="font-bold text-green-700 mb-4">
              <i class="fas fa-robot mr-2"></i>
              AI Analysis Complete
            </h4>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span>Groceries (Organic foods)</span>
                <span class="font-semibold text-green-600">2.3 kg CO‚ÇÇ</span>
              </div>
              <div class="flex justify-between">
                <span>Fuel (Petrol station)</span>
                <span class="font-semibold text-red-600">15.7 kg CO‚ÇÇ</span>
              </div>
              <div class="flex justify-between">
                <span>Restaurant (Local dining)</span>
                <span class="font-semibold text-orange-600">4.1 kg CO‚ÇÇ</span>
              </div>
              <hr class="my-3">
              <div class="flex justify-between text-lg font-bold">
                <span>Total Impact</span>
                <span class="text-slate-800">22.1 kg CO‚ÇÇ</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Food Calculator Tab -->
    <div id="calculator" class="tab-content">
      <div class="max-w-4xl mx-auto" data-aos="fade-up">
        <div class="bg-white rounded-3xl p-8 shadow-lg border border-orange-100">
          <h3 class="text-2xl font-bold text-slate-800 mb-6 text-center">
            <i class="fas fa-utensils text-orange-500 mr-2"></i>
            Food Carbon Calculator
          </h3>
          
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Input Section -->
            <div>
              <label class="block text-lg font-semibold text-slate-700 mb-4">
                What did you eat?
              </label>
              <input type="text" placeholder="e.g., butter chicken, beef burger, quinoa salad" 
                     class="form-input mb-4" id="foodInput" oninput="calculateFoodCarbon()">
              
              <div class="mb-4">
                <label class="block text-sm font-medium text-slate-600 mb-2">Portion size</label>
                <select class="form-select" id="portionSize">
                  <option value="small">Small</option>
                  <option value="medium" selected>Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>
              
              <button class="btn-primary w-full" onclick="calculateFoodCarbon()">
                <i class="fas fa-calculator"></i>
                Calculate Emissions
              </button>
            </div>
            
            <!-- Results Section -->
            <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6">
              <h4 class="font-bold text-slate-800 mb-4">Emission Estimate</h4>
              
              <div class="text-center mb-6">
                <div class="text-4xl font-black text-orange-600" id="foodCarbonResult">0.0</div>
                <div class="text-sm text-slate-600">kg CO‚ÇÇ equivalent</div>
              </div>
              
              <!-- Food Comparison -->
              <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                  <span>ü•ó Vegan meal</span>
                  <span class="text-green-600">0.5 kg CO‚ÇÇ</span>
                </div>
                <div class="flex justify-between">
                  <span>üêü Fish meal</span>
                  <span class="text-yellow-600">2.1 kg CO‚ÇÇ</span>
                </div>
                <div class="flex justify-between">
                  <span>üêÑ Beef meal</span>
                  <span class="text-red-600">6.8 kg CO‚ÇÇ</span>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-white rounded-lg">
                <p class="text-sm text-slate-600">
                  <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>
                  <strong>Tip:</strong> Choosing plant-based options can reduce your food carbon footprint by up to 70%!
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Initialize AOS
  AOS.init({
    duration: 800,
    once: true,
    offset: 100
  });

  // Tab switching functionality
  function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
      content.classList.remove('active');
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(button => {
      button.classList.remove('active');
    });
    
    // Show selected tab content
    document.getElementById(tabName).classList.add('active');
    
    // Add active class to clicked button
    event.target.classList.add('active');
  }

  // Update slider values
  function updateValue(type, value) {
    document.getElementById(type + 'Value').textContent = value + ' km';
    updateCalculation();
  }

  // Real-time calculation
  function updateCalculation() {
    const travel = parseInt(document.getElementById('travelSlider').value) || 0;
    const meat = parseInt(document.getElementById('meatMeals').value) || 0;
    const electricity = parseInt(document.getElementById('electricity').value) || 0;
    const shopping = document.getElementById('shopping').value;
    
    // Simple calculation (replace with actual API call)
    const travelEmissions = travel * 0.17; // kg CO2 per km
    const foodEmissions = meat * 0.83; // kg CO2 per meal per week / 7
    const energyEmissions = electricity * 0.007; // kg CO2 per kWh / 30 days
    const shoppingMultiplier = shopping === 'low' ? 0.5 : shopping === 'high' ? 2 : 1;
    const shoppingEmissions = 0.4 * shoppingMultiplier;
    
    const total = travelEmissions + foodEmissions + energyEmissions + shoppingEmissions;
    
    // Update display
    document.getElementById('totalEmissions').textContent = total.toFixed(1);
    document.getElementById('travelEmissions').textContent = travelEmissions.toFixed(1);
    document.getElementById('foodEmissions').textContent = foodEmissions.toFixed(1);
    document.getElementById('energyEmissions').textContent = energyEmissions.toFixed(1);
    document.getElementById('shoppingEmissions').textContent = shoppingEmissions.toFixed(1);
    
    // Update hotspot
    const categories = [
      { name: 'Travel', value: travelEmissions },
      { name: 'Food', value: foodEmissions },
      { name: 'Energy', value: energyEmissions },
      { name: 'Shopping', value: shoppingEmissions }
    ];
    
    const hotspot = categories.reduce((max, cat) => cat.value > max.value ? cat : max);
    document.getElementById('hotspot').textContent = `${hotspot.name} is your highest emission source`;
  }

  // File upload handling
  function handleFiles(files) {
    const preview = document.getElementById('filePreview');
    const results = document.getElementById('aiResults');
    
    preview.style.display = 'grid';
    preview.innerHTML = '';
    
    Array.from(files).forEach(file => {
      const div = document.createElement('div');
      div.className = 'bg-gray-100 rounded-lg p-4 text-center';
      div.innerHTML = `
        <i class="fas fa-file-image text-2xl text-blue-500 mb-2"></i>
        <div class="text-sm font-medium truncate">${file.name}</div>
        <div class="text-xs text-gray-500">${(file.size / 1024).toFixed(1)} KB</div>
      `;
      preview.appendChild(div);
    });
    
    // Simulate AI processing
    setTimeout(() => {
      results.style.display = 'block';
    }, 2000);
  }

  // Drag and drop functionality
  const dropArea = document.getElementById('dropArea');
  
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
  });
  
  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }
  
  ['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.add('dragover'), false);
  });
  
  ['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.remove('dragover'), false);
  });
  
  dropArea.addEventListener('drop', (e) => {
    const files = e.dataTransfer.files;
    handleFiles(files);
  });

  // Food carbon calculator
  function calculateFoodCarbon() {
    const food = document.getElementById('foodInput').value.toLowerCase();
    const portion = document.getElementById('portionSize').value;
    
    // Simple food carbon database (replace with actual API)
    const foodDatabase = {
      'beef': 6.8,
      'burger': 5.2,
      'chicken': 2.1,
      'fish': 1.8,
      'pork': 3.4,
      'lamb': 7.2,
      'cheese': 2.8,
      'milk': 0.9,
      'egg': 1.1,
      'rice': 0.4,
      'pasta': 0.3,
      'bread': 0.2,
      'vegetable': 0.1,
      'fruit': 0.1,
      'quinoa': 0.2,
      'tofu': 0.3
    };
    
    let emissions = 0;
    Object.keys(foodDatabase).forEach(key => {
      if (food.includes(key)) {
        emissions = Math.max(emissions, foodDatabase[key]);
      }
    });
    
    // Adjust for portion size
    const portionMultiplier = portion === 'small' ? 0.7 : portion === 'large' ? 1.5 : 1;
    emissions *= portionMultiplier;
    
    document.getElementById('foodCarbonResult').textContent = emissions.toFixed(1);
  }

  // Save to dashboard
  function saveToDashboard() {
    // Simulate saving data
    alert('Data saved! Redirecting to dashboard...');
    // In real implementation, this would save to backend and redirect
    // window.location.href = '/dashboard/';
  }

  // Initialize calculations
  updateCalculation();
</script>

{% endblock %}
